# AO é¡¹ç›® BigInteger è¿ç§»è§„åˆ’

## æ¦‚è¿°

æœ¬æ–‡æ¡£è¯¦ç»†è§„åˆ’å°† A-AO-Demo é¡¹ç›®ä¸­åŸæ¥å¤šä¸ªä½¿ç”¨ Lua `number` ç±»å‹çš„åœ°æ–¹æ”¹ä¸ºä½¿ç”¨ `bint` (BigInteger) çš„å®Œæ•´æ–¹æ¡ˆã€‚è¿ç§»çš„ç›®æ ‡æ˜¯ç¡®ä¿æ•°å€¼è®¡ç®—çš„ç²¾åº¦å’Œå®‰å…¨æ€§ï¼ŒåŒæ—¶ä¿æŒ AO å¹³å°çš„æ¶ˆæ¯åºåˆ—åŒ–å…¼å®¹æ€§ã€‚

**å®æ–½çŠ¶æ€**: Phase 1 (IDåºåˆ—ç”Ÿæˆå™¨è¿ç§») å·²å®Œæˆ âœ…

---

## ğŸ“Š å½“å‰é¡¹ç›®ä¸­çš„æ•°å­—ä½¿ç”¨æƒ…å†µåˆ†æ

### 1. ID åºåˆ—ç”Ÿæˆå™¨

#### **ArticleIdSequence**
- **å½“å‰ä½ç½®**: `src/a_ao_demo.lua`, `src/blog_main.lua`
- **å½“å‰æ ¼å¼**: `{ 0 }` (æ•°ç»„æ ¼å¼)
- **ä½¿ç”¨æ–¹å¼**: `article_id_sequence[1]` è®¿é—®ï¼Œ`article_id_sequence[1] = article_id_sequence[1] + 1` é€’å¢
- **å½±å“èŒƒå›´**: æ–‡ç« åˆ›å»ºæ—¶ç”Ÿæˆå”¯ä¸€ID

#### **SagaIdSequence**
- **å½“å‰ä½ç½®**: `src/a_ao_demo.lua`, `src/blog_main.lua`
- **å½“å‰æ ¼å¼**: `{ 0 }` (æ•°ç»„æ ¼å¼)
- **ä½¿ç”¨æ–¹å¼**: `saga_id_sequence[1]` è®¿é—®ï¼Œ`saga_id_sequence[1] = saga_id_sequence[1] + 1` é€’å¢
- **å½±å“èŒƒå›´**: Saga äº‹åŠ¡åˆ›å»ºæ—¶ç”Ÿæˆå”¯ä¸€ID

### 2. ç‰ˆæœ¬å·ç®¡ç†

#### **å®ä½“ç‰ˆæœ¬æ§åˆ¶**
- **å½±å“æ–‡ä»¶**: `src/article_aggregate.lua`, `src/inventory_item_aggregate.lua`
- **å½“å‰é€»è¾‘**: `version = (version and version or 0) + 1`
- **ä½¿ç”¨åœºæ™¯**: å¹¶å‘æ§åˆ¶ï¼Œä¹è§‚é”æœºåˆ¶
- **å­˜å‚¨ä½ç½®**: å®ä½“çŠ¶æ€çš„ `version` å­—æ®µ

#### **ç‰ˆæœ¬æ¯”è¾ƒ**
- **å½±å“é€»è¾‘**: `_state.version ~= cmd.version` (å¹¶å‘å†²çªæ£€æµ‹)
- **å…³é”®æ“ä½œ**: ç‰ˆæœ¬å·çš„é€’å¢å’Œæ¯”è¾ƒ

### 3. æ•°é‡å’Œè®¡æ•°å­—æ®µ

#### **åº“å­˜æ•°é‡**
- **å½±å“æ–‡ä»¶**: `src/inventory_item_add_inventory_item_entry_logic.lua`
- **å½“å‰é€»è¾‘**: `state.quantity = (state.quantity or 0) + event.movement_quantity`
- **æ•°æ®ç±»å‹**: `movement_quantity`, `quantity` å­—æ®µ
- **è¿ç®—ç±»å‹**: åŠ æ³•è¿ç®—

#### **è¯„è®ºåºåˆ—å·**
- **å½±å“æ–‡ä»¶**: `src/comment_coll.lua`, `src/article_comment_id.lua`, `src/article_add_comment_logic.lua`
- **å½“å‰é€»è¾‘**: æ¯ä¸ªæ–‡ç« ç»´æŠ¤ `comment_seq_id_generator` å­—æ®µï¼Œé€’å¢ç”Ÿæˆ
- **ä½¿ç”¨åœºæ™¯**: è¯„è®ºçš„å”¯ä¸€æ ‡è¯†
- **å­˜å‚¨ä½ç½®**: æ–‡ç« çŠ¶æ€ä¸­çš„ `comment_seq_id_generator` å­—æ®µ
- **æ½œåœ¨é—®é¢˜**: å¦‚æœæ–‡ç« è¯„è®ºå¾ˆå¤šï¼Œæ­¤å­—æ®µå¯èƒ½è¶…è¿‡ number èŒƒå›´

#### **æ—¶é—´æˆ³å­—æ®µ (æ— éœ€è¿ç§»)**
- **å½±å“æ–‡ä»¶**: `src/inventory_item_entry.lua`
- **å½“å‰é€»è¾‘**: `timestamp` å­—æ®µè®°å½•åº“å­˜æ¡ç›®æ—¶é—´
- **æ•°æ®ç±»å‹**: æ¯«ç§’çº§æ—¶é—´æˆ³ (13ä½æ•°å­—)
- **è¯„ä¼°ç»“è®º**: Lua number ç²¾åº¦ (2^53 â‰ˆ 9Ã—10^15) è¿œå¤§äº13ä½æ•°å­—ï¼Œæ— éœ€è¿ç§»

#### **Saga æ­¥éª¤è®¡æ•°å™¨ (æ— éœ€è¿ç§»)**
- **å½±å“æ–‡ä»¶**: `src/saga.lua`, `src/inventory_service.lua`
- **å½“å‰é€»è¾‘**: `saga_instance.current_step` è®°å½• Saga æ‰§è¡Œæ­¥éª¤
- **è¯„ä¼°ç»“è®º**: Saga æ­¥éª¤é€šå¸¸ä¸è¶…è¿‡100æ­¥ï¼ŒLua number å®Œå…¨è¶³å¤Ÿï¼Œæ— éœ€è¿ç§»

#### **Saga ä¸Šä¸‹æ–‡ç‰ˆæœ¬å·**
- **å½±å“æ–‡ä»¶**: `src/inventory_service.lua`
- **å½“å‰é€»è¾‘**: `context.item_version`, `context.in_out_version` ç­‰
- **ä½¿ç”¨åœºæ™¯**: Saga äº‹åŠ¡ä¸­çš„ç‰ˆæœ¬æ§åˆ¶
- **æ½œåœ¨é—®é¢˜**: ç‰ˆæœ¬å·æŒç»­é€’å¢å¯èƒ½å¾ˆå¤§

### 4. å¾ªç¯è®¡æ•°å™¨

#### **ç»Ÿè®¡è®¡æ•°**
- **å½±å“æ–‡ä»¶**: `src/a_ao_demo.lua`, `src/blog_main.lua`
- **å½“å‰é€»è¾‘**: `count = count + 1` (æ–‡ç« æ•°é‡ç»Ÿè®¡)
- **ä½¿ç”¨åœºæ™¯**: åªè¯»ç»Ÿè®¡ï¼Œæ— æŒä¹…åŒ–éœ€æ±‚

### 5. è¯„è®ºåºå·ç‰¹æ®Šå¤„ç†

#### **æ¶æ„ç‰¹ç‚¹**
è¯„è®ºåºå·çš„å¤„ç†ä¸å…¶ä»–åºåˆ—å·å®Œå…¨ä¸åŒï¼š

1. **éå…¨å±€åºåˆ—**: ä¸å­˜åœ¨å…¨å±€çš„è¯„è®ºIDåºåˆ—ç”Ÿæˆå™¨
2. **æ–‡ç« çº§åˆ«**: æ¯ä¸ªæ–‡ç« ç»´æŠ¤è‡ªå·±çš„ `comment_seq_id_generator` å­—æ®µ
3. **çŠ¶æ€å­˜å‚¨**: è¯¥å­—æ®µå­˜å‚¨åœ¨æ–‡ç« çš„æŒä¹…åŒ–çŠ¶æ€ä¸­
4. **é«˜é¢‘é€’å¢**: å¦‚æœæ–‡ç« è¯„è®ºå¾ˆå¤šï¼Œè¯¥å­—æ®µå¢é•¿è¿…é€Ÿ

#### **å½“å‰å®ç°**
```lua
-- åœ¨ article_add_comment_logic.lua ä¸­
_state.comment_seq_id_generator = (_state.comment_seq_id_generator or 0) + 1
local comment_seq_id = _state.comment_seq_id_generator
```

#### **è¿ç§»ç­–ç•¥**
```lua
-- å½“å‰: å­˜å‚¨åœ¨æ–‡ç« çŠ¶æ€ä¸­ä½œä¸º number
article.comment_seq_id_generator = 12345

-- è¿ç§»å: å­˜å‚¨ä¸ºå­—ç¬¦ä¸²
article.comment_seq_id_generator = "12345"

-- è¿ç®—æ—¶è½¬æ¢ (åœ¨ article_add_comment_logic.lua ä¸­)
local current_gen = bint(_state.comment_seq_id_generator or "0")
_state.comment_seq_id_generator = tostring(current_gen + 1)
local comment_seq_id = bint(_state.comment_seq_id_generator)
```

#### **é£é™©è¯„ä¼°**
- **å½±å“èŒƒå›´**: ä¸­ç­‰ (åªå½±å“è¯„è®ºæ·»åŠ é€»è¾‘)
- **æ•°æ®è¿ç§»**: éœ€è¦è¿ç§»æ‰€æœ‰æ–‡ç« çš„ `comment_seq_id_generator` å­—æ®µ
- **å¹¶å‘é£é™©**: ä½ (è¯„è®ºæ·»åŠ é€šå¸¸æ˜¯é¡ºåºçš„)

---



## ğŸ¯ è¿ç§»ç­–ç•¥åˆ†æ

### 1. æ•°æ®å­˜å‚¨æ ¼å¼å˜æ›´

#### **åºåˆ—å·å­˜å‚¨ç­–ç•¥**
```lua
-- å½“å‰æ ¼å¼ (éœ€è¦è¿ç§»)
ArticleIdSequence = { 0 }          -- æ•°ç»„æ ¼å¼
SagaIdSequence = { 0 }             -- æ•°ç»„æ ¼å¼

-- å»ºè®®çš„æ–°æ ¼å¼ (å­—ç¬¦ä¸²å­˜å‚¨)
ArticleIdSequence = { current = "0" }
SagaIdSequence = { current = "0" }

-- æ‰©å±•æ ¼å¼ (é¢„ç•™æœªæ¥æ‰©å±•æ€§)
ArticleIdSequence = {
    current = "0",        -- å½“å‰å€¼ (å­—ç¬¦ä¸²)
    increment = "1",      -- é€’å¢æ­¥é•¿ (å­—ç¬¦ä¸²)
    type = "article"      -- ç±»å‹æ ‡è¯†
}
```

#### **å®ä½“ç‰ˆæœ¬å·å­˜å‚¨**
```lua
-- å½“å‰æ ¼å¼ (number)
article = {
    version = 5,          -- number ç±»å‹
    // ... å…¶ä»–å­—æ®µ
}

-- æ–°æ ¼å¼ (string) - å­˜å‚¨å’Œä¼ è¾“éƒ½ç”¨å­—ç¬¦ä¸²
article = {
    version = "5",        -- string ç±»å‹
    // ... å…¶ä»–å­—æ®µ
}
```

#### **ç‰ˆæœ¬å·è¿ç®—ç­–ç•¥ (åŸºäºå®é™…ä»£ç )**
```lua
-- æ¯”è¾ƒæ“ä½œ: å­—ç¬¦ä¸² vs å­—ç¬¦ä¸² (ä» cmd å’Œ _state æ¥çš„éƒ½æ˜¯å­—ç¬¦ä¸²)
if _state.version ~= cmd.version then  -- éƒ½æ˜¯å­—ç¬¦ä¸²æ¯”è¾ƒ
    error(ERRORS.CONCURRENCY_CONFLICT)
end

-- é€’å¢æ“ä½œ: å­—ç¬¦ä¸² -> bint -> è¿ç®— -> å­—ç¬¦ä¸²
local current_version = bint(version or "0")  -- ä»å­—ç¬¦ä¸²è½¬æ¢ä¸º bint
local new_version = current_version + 1       -- bint è¿ç®—
_new_state.version = tostring(new_version)    -- è½¬å›å­—ç¬¦ä¸²å­˜å‚¨

-- å®é™…ä»£ç ç¤ºä¾‹ (article_aggregate.lua)
_new_state.version = tostring(bint(version or "0") + 1)
```

**å…³é”®æ´å¯Ÿ**: `cmd.version` (å¤–éƒ¨è¾“å…¥) å’Œ `_state.version` (å­˜å‚¨çŠ¶æ€) éƒ½åº”ä¸ºå­—ç¬¦ä¸²ï¼Œåªæœ‰è¿ç®—æ—¶æ‰è½¬æ¢ä¸º bintã€‚

#### **å®é™…ä»£ç ä¿®æ”¹ç¤ºä¾‹**
```lua
-- å½“å‰ç‰ˆæœ¬å·å¤„ç† (article_aggregate.lua ç¬¬87è¡Œ)
_new_state.version = (version and version or 0) + 1

-- è¿ç§»åç‰ˆæœ¬å·å¤„ç†
_new_state.version = tostring(bint(version or "0") + 1)
```

**è¯´æ˜**: å¤–éƒ¨ä¼ å…¥çš„ `cmd.version` å’Œå­˜å‚¨çš„ `_state.version` éƒ½åº”ä¸ºå­—ç¬¦ä¸²æ ¼å¼ï¼Œåªåœ¨é€’å¢è¿ç®—æ—¶è½¬æ¢ä¸º bint å¤„ç†ã€‚

#### **æ—¶é—´æˆ³å­—æ®µ (ä¿æŒ number)**
- **ç»“è®º**: æ— éœ€è¿ç§»ï¼ŒLua number å®Œå…¨æ»¡è¶³æ—¶é—´æˆ³ç²¾åº¦éœ€æ±‚
- **åŸå› **: æ¯«ç§’çº§æ—¶é—´æˆ³(13ä½)è¿œå°äº Lua number å®‰å…¨èŒƒå›´(2^53)

#### **Saga æ­¥éª¤è®¡æ•°å™¨ (ä¿æŒ number)**
- **ç»“è®º**: æ— éœ€è¿ç§»ï¼Œå¸¸è§„ Saga æ­¥éª¤æ•°åœ¨ Lua number å®‰å…¨èŒƒå›´å†…
- **åŸå› **: å®é™…ä¸šåŠ¡ä¸­ Saga æ­¥éª¤é€šå¸¸ä¸è¶…è¿‡ 10-20 æ­¥

#### **Saga ä¸Šä¸‹æ–‡ç‰ˆæœ¬å·è¿ç§»ç­–ç•¥**
```lua
-- å½“å‰æ ¼å¼ (number)
context = {
    item_version = 123,
    in_out_version = 456,
    // ...
}

-- è¿ç§»åæ ¼å¼ (string)
context = {
    item_version = "123",
    in_out_version = "456",
    // ...
}

-- ä½¿ç”¨æ—¶è½¬æ¢ (é€šå¸¸ä½œä¸ºå‚æ•°ä¼ é€’ï¼Œæ— å¤æ‚è¿ç®—)
local version_bint = bint(context.item_version)
```

#### **æ•°é‡å­—æ®µå­˜å‚¨**
```lua
-- å½“å‰æ ¼å¼ (number)
inventory_item = {
    quantity = 100,       -- number ç±»å‹
    // ... å…¶ä»–å­—æ®µ
}

-- æ–°æ ¼å¼ (string)
inventory_item = {
    quantity = "100",     -- string ç±»å‹
    // ... å…¶ä»–å­—æ®µ
}
```

### 2. è¿ç®—æ—¶è½¬æ¢ç­–ç•¥

#### **è¿è¡Œæ—¶è½¬æ¢æ¨¡å¼**
```lua
-- è¯»å–æ—¶: å­—ç¬¦ä¸² -> bint
local current_version_bint = bint(article.version)

-- è¿ç®—æ—¶: bint è¿ç®—
local new_version_bint = current_version_bint + 1

-- å­˜å‚¨æ—¶: bint -> å­—ç¬¦ä¸²
article.version = tostring(new_version_bint)
```

### 3. å‘åå…¼å®¹æ€§å¤„ç†

#### **è‡ªåŠ¨è¿ç§»é€»è¾‘**
```lua
-- åœ¨åˆå§‹åŒ–æ—¶æ£€æµ‹å¹¶è¿ç§»æ—§æ ¼å¼
ArticleIdSequence = ArticleIdSequence and (
    function(old_data)
        -- æ£€æµ‹æ—§æ ¼å¼: { 0 }
        if type(old_data) == "table" and type(old_data[1]) == "number" then
            return { current = tostring(old_data[1]) }
        end
        -- å·²ç»æ˜¯æ–°æ ¼å¼æˆ– nil
        return old_data
    end
)(ArticleIdSequence) or { current = "0" }
```

#### **æ¸è¿›å¼è¿ç§»**
1. **Phase 1**: åªè¿ç§» ID åºåˆ—ç”Ÿæˆå™¨ (å½±å“æœ€å°)
2. **Phase 2**: è¿ç§»ç‰ˆæœ¬å·ç³»ç»Ÿ
3. **Phase 3**: è¿ç§»æ•°é‡å­—æ®µ
4. **Phase 4**: è¿ç§»å…¶ä»–æ•°å€¼å­—æ®µ

---

## ğŸ” å½±å“èŒƒå›´è¯„ä¼°

### 1. é«˜å½±å“åŒºåŸŸ

#### **ID åºåˆ—ç”Ÿæˆå™¨**
- **å½±å“æ–‡ä»¶**: æ‰€æœ‰ä¸»æ–‡ä»¶ (`*_main.lua`)
- **å½±å“èŒƒå›´**: ID ç”Ÿæˆé€»è¾‘
- **æµ‹è¯•å¤æ‚åº¦**: ä¸­ç­‰ (éœ€è¦éªŒè¯ ID å”¯ä¸€æ€§)
- **å›æ»šéš¾åº¦**: ä½ (å¯ä»¥æ¢å¤æ•°ç»„æ ¼å¼)

#### **ç‰ˆæœ¬å·ç³»ç»Ÿ**
- **å½±å“æ–‡ä»¶**: æ‰€æœ‰ aggregate æ–‡ä»¶
- **å½±å“èŒƒå›´**: å¹¶å‘æ§åˆ¶æœºåˆ¶
- **æµ‹è¯•å¤æ‚åº¦**: é«˜ (å¹¶å‘åœºæ™¯æµ‹è¯•)
- **å›æ»šéš¾åº¦**: ä¸­ç­‰ (éœ€è¦æ•°æ®è¿ç§»)

### 2. ä¸­ç­‰å½±å“åŒºåŸŸ

#### **åº“å­˜æ•°é‡è®¡ç®—**
- **å½±å“æ–‡ä»¶**: inventory ç›¸å…³é€»è¾‘æ–‡ä»¶
- **å½±å“èŒƒå›´**: åº“å­˜ç®¡ç†ä¸šåŠ¡é€»è¾‘
- **æµ‹è¯•å¤æ‚åº¦**: ä¸­ç­‰
- **å›æ»šéš¾åº¦**: ä¸­ç­‰

#### **è¯„è®ºåºåˆ—å·**
- **å½±å“æ–‡ä»¶**: comment_coll.lua, article_comment_id.lua
- **å½±å“èŒƒå›´**: è¯„è®ºåŠŸèƒ½
- **æµ‹è¯•å¤æ‚åº¦**: ä½
- **å›æ»šéš¾åº¦**: ä½

### 3. ä½å½±å“åŒºåŸŸ

#### **ç»Ÿè®¡è®¡æ•°å™¨**
- **å½±å“æ–‡ä»¶**: å„ç§ç»Ÿè®¡å‡½æ•°
- **å½±å“èŒƒå›´**: åªè¯»ç»Ÿè®¡åŠŸèƒ½
- **æµ‹è¯•å¤æ‚åº¦**: ä½
- **å›æ»šéš¾åº¦**: ä½ (æ— éœ€æŒä¹…åŒ–)

---

## âš ï¸ é£é™©è¯„ä¼°

### 1. æŠ€æœ¯é£é™©

#### **åºåˆ—åŒ–å…¼å®¹æ€§**
- **é£é™©ç­‰çº§**: é«˜
- **å½±å“**: AO æ¶ˆæ¯ä¼ é€’å¤±è´¥
- **ç¼“è§£æ–¹æ¡ˆ**: ä¸¥æ ¼ä½¿ç”¨å­—ç¬¦ä¸²å­˜å‚¨ï¼Œbint ä»…ç”¨äºè¿ç®—

#### **æ€§èƒ½å½±å“**
- **é£é™©ç­‰çº§**: ä¸­ç­‰
- **å½±å“**: bint è¿ç®—æ¯” number æ…¢
- **ç¼“è§£æ–¹æ¡ˆ**: åªåœ¨å¿…è¦æ—¶ä½¿ç”¨ bintï¼Œå¸¸è§„è®¡æ•°ä»ç”¨ number

#### **å†…å­˜ä½¿ç”¨**
- **é£é™©ç­‰çº§**: ä½
- **å½±å“**: bint å¯¹è±¡å ç”¨æ›´å¤šå†…å­˜
- **ç¼“è§£æ–¹æ¡ˆ**: åŠæ—¶é‡Šæ”¾ä¸´æ—¶ bint å¯¹è±¡

### 2. ä¸šåŠ¡é£é™©

#### **æ•°æ®ç²¾åº¦**
- **é£é™©ç­‰çº§**: é«˜
- **å½±å“**: å¤§æ•°å­—è®¡ç®—é”™è¯¯
- **ç¼“è§£æ–¹æ¡ˆ**: å…¨é¢æµ‹è¯•å¤§æ•°å­—åœºæ™¯

#### **å¹¶å‘æ§åˆ¶**
- **é£é™©ç­‰çº§**: é«˜
- **å½±å“**: ç‰ˆæœ¬å·æ¯”è¾ƒé€»è¾‘é”™è¯¯
- **ç¼“è§£æ–¹æ¡ˆ**: å®Œå–„å¹¶å‘æµ‹è¯•ç”¨ä¾‹

### 3. æ“ä½œé£é™©

#### **è¿ç§»å¤æ‚åº¦**
- **é£é™©ç­‰çº§**: ä¸­ç­‰
- **å½±å“**: è¿ç§»è¿‡ç¨‹ä¸­æ•°æ®ä¸ä¸€è‡´
- **ç¼“è§£æ–¹æ¡ˆ**: å®ç°è‡ªåŠ¨è¿ç§»é€»è¾‘ï¼Œåˆ†é˜¶æ®µæ‰§è¡Œ

#### **å›æ»šéš¾åº¦**
- **é£é™©ç­‰çº§**: ä¸­ç­‰
- **å½±å“**: å‡ºç°é—®é¢˜æ—¶éš¾ä»¥å›æ»š
- **ç¼“è§£æ–¹æ¡ˆ**: ä¿ç•™å‘åå…¼å®¹æ€§ï¼Œå‡†å¤‡å›æ»šè„šæœ¬

## ğŸ”„ æ•°æ®è¿ç§»ç­–ç•¥

### ğŸ¯ **é¡¹ç›®ç°çŠ¶**: å¼€å‘/æµ‹è¯•ç¯å¢ƒï¼Œæ— éœ€å¤§è§„æ¨¡è¿ç§»

**ç°çŠ¶åˆ†æ**:
- âœ… **æ— æ­£å¼ç³»ç»Ÿ**: ä¸å­˜åœ¨ç”Ÿäº§ç¯å¢ƒçš„é—ç•™æ•°æ®
- âœ… **ç®€åŒ–å®æ–½**: å¤§éƒ¨åˆ†å­—æ®µç›´æ¥é‡‡ç”¨æ–°æ ¼å¼ï¼Œæ— éœ€è¿ç§»
- âœ… **ä¿ç•™ç¤ºä¾‹**: ä»…ä¿ç•™ ArticleIdSequence è¿ç§»ä½œä¸ºæŠ€æœ¯ç¤ºä¾‹

### ğŸ“‹ å®æ–½æ—¶çš„æ ¼å¼çº¦å®š

#### **ç›´æ¥ä½¿ç”¨æ–°æ ¼å¼**
```lua
-- ä¸»æ–‡ä»¶ä¸­çš„åˆå§‹å€¼ç›´æ¥ä½¿ç”¨å­—ç¬¦ä¸²æ ¼å¼
ArticleIdSequence = { current = "0" }
SagaIdSequence = { current = "0" }

-- æ–‡ç« çŠ¶æ€ä¸­çš„åˆå§‹å€¼
article.comment_seq_id_generator = "0"
article.version = "1"  -- ç›´æ¥å­—ç¬¦ä¸²
```

#### **æ–°å¯¹è±¡åˆ›å»º**
```lua
-- åˆ›å»ºæ–°æ–‡ç« æ—¶ç›´æ¥ä½¿ç”¨å­—ç¬¦ä¸²æ ¼å¼
local new_article = {
    version = "1",  -- ç›´æ¥å­—ç¬¦ä¸²ï¼Œæ— éœ€è½¬æ¢
    comment_seq_id_generator = "0"
}
```

### ğŸ”„ **æ•°æ®è¿ç§»ç¤ºä¾‹**: ArticleIdSequence

#### **è¿ç§»è„šæœ¬ (ä»…ä½œä¸ºæŠ€æœ¯ç¤ºä¾‹)**
```lua
-- ArticleIdSequence è‡ªåŠ¨è¿ç§»ç¤ºä¾‹
-- è¯´æ˜: å½“å‰é¡¹ç›®æ— éœ€æ­¤è¿ç§»ï¼Œä½†ä¿ç•™ä½œä¸ºæŠ€æœ¯å‚è€ƒ
ArticleIdSequence = ArticleIdSequence and (
    function(old_data)
        -- å¦‚æœæ˜¯æ—§æ ¼å¼çš„æ•°ç»„ {0, 1, 2, ...}
        if type(old_data) == "table" and type(old_data[1]) == "number" then
            print("è¿ç§» ArticleIdSequence ä»æ•°ç»„æ ¼å¼åˆ°å¯¹è±¡æ ¼å¼")
            return { current = tostring(old_data[1]) }
        end
        -- å¦‚æœå·²ç»æ˜¯å¯¹è±¡æ ¼å¼ä½†å€¼æ˜¯number
        if type(old_data) == "table" and type(old_data.current) == "number" then
            print("è¿ç§» ArticleIdSequence.current ä» number åˆ° string")
            return { current = tostring(old_data.current) }
        end
        -- å·²ç»æ˜¯æ­£ç¡®æ ¼å¼
        return old_data
    end
)(ArticleIdSequence) or { current = "0" }
```

#### **ä¸ºä»€ä¹ˆä¿ç•™æ­¤ç¤ºä¾‹**
1. **æŠ€æœ¯å‚è€ƒ**: å±•ç¤ºå¦‚ä½•å¤„ç†æ ¼å¼è¿ç§»
2. **æ¨¡å¼å¤ç”¨**: å°†æ¥å¦‚éœ€è¿ç§»å…¶ä»–å­—æ®µå¯å‚è€ƒæ­¤æ¨¡å¼
3. **å­¦ä¹ ä»·å€¼**: ç†è§£æ¸è¿›å¼æ•°æ®è¿ç§»çš„å®ç°æ–¹å¼

### ğŸ“Š **æ ¼å¼éªŒè¯ç­–ç•¥**

#### **æ•°æ®æ ¼å¼ä¸€è‡´æ€§æ£€æŸ¥**
```lua
local function validate_data_formats()
    -- æ£€æŸ¥åºåˆ—å·æ ¼å¼
    assert(type(ArticleIdSequence.current) == "string", "ArticleIdSequence.current åº”ä¸ºå­—ç¬¦ä¸²")
    assert(type(SagaIdSequence.current) == "string", "SagaIdSequence.current åº”ä¸ºå­—ç¬¦ä¸²")

    -- æ£€æŸ¥æ–‡ç« çŠ¶æ€æ ¼å¼
    for article_id, article in pairs(ArticleTable or {}) do
        assert(type(article.version) == "string", "æ–‡ç« ç‰ˆæœ¬å·åº”ä¸ºå­—ç¬¦ä¸²")
        assert(type(article.comment_seq_id_generator) == "string", "è¯„è®ºç”Ÿæˆå™¨åº”ä¸ºå­—ç¬¦ä¸²")
    end

    -- Saga æ­¥éª¤ä¿æŒ number ç±»å‹
    for saga_id, saga_instance in pairs(SagaInstances or {}) do
        assert(type(saga_instance.current_step) == "number", "Sagaæ­¥éª¤ä¿æŒnumberç±»å‹")
    end

    print("âœ… æ‰€æœ‰æ•°æ®æ ¼å¼éªŒè¯é€šè¿‡")
end

-- åœ¨åº”ç”¨å¯åŠ¨æ—¶è°ƒç”¨éªŒè¯
validate_data_formats()
```

---

## ğŸ§ª æµ‹è¯•ç­–ç•¥

### 1. å•å…ƒæµ‹è¯•

#### **ID ç”Ÿæˆæµ‹è¯•**
```lua
-- æµ‹è¯• ID å”¯ä¸€æ€§å’Œé€’å¢
local id1 = next_article_id()  -- åº”è¿”å› bint(1)
local id2 = next_article_id()  -- åº”è¿”å› bint(2)
assert(id1 < id2, "ID åº”è¯¥é€’å¢")
```

#### **ç‰ˆæœ¬å·æµ‹è¯•**
```lua
-- æµ‹è¯•ç‰ˆæœ¬å·é€’å¢å’Œæ¯”è¾ƒ
local version = bint("5")
local new_version = version + 1
assert(tostring(new_version) == "6", "ç‰ˆæœ¬å·é€’å¢æ­£ç¡®")
```

### 2. é›†æˆæµ‹è¯•

#### **Saga äº‹åŠ¡æµ‹è¯•**
- æµ‹è¯•è·¨è¿›ç¨‹ Saga äº‹åŠ¡ä¸­çš„ ID ç”Ÿæˆ
- éªŒè¯ bint ID çš„åºåˆ—åŒ–/ååºåˆ—åŒ–

#### **å¹¶å‘æ§åˆ¶æµ‹è¯•**
- å¤šä¸ªè¿›ç¨‹åŒæ—¶åˆ›å»ºæ–‡ç« /åº“å­˜é¡¹
- éªŒè¯ç‰ˆæœ¬å·å†²çªæ£€æµ‹

### 3. ç«¯åˆ°ç«¯æµ‹è¯•

#### **å®Œæ•´ä¸šåŠ¡æµç¨‹**
- åˆ›å»ºæ–‡ç«  â†’ æ·»åŠ è¯„è®º â†’ æ›´æ–°åº“å­˜
- éªŒè¯æ‰€æœ‰æ•°å­—å­—æ®µçš„æ­£ç¡®å¤„ç†

#### **å¤§æ•°å­—æµ‹è¯•**
- ä½¿ç”¨æ¥è¿‘ bint é™åˆ¶çš„æ•°å­—è¿›è¡Œæµ‹è¯•
- éªŒè¯ç²¾åº¦å’Œæ€§èƒ½

#### **æ—¶é—´æˆ³å­—æ®µæµ‹è¯• (ä¿æŒ number)**
```lua
-- æ—¶é—´æˆ³ä¿æŒ number ç±»å‹ï¼Œæ— éœ€ç‰¹æ®Šæµ‹è¯•
local timestamp = 1698765432123  -- 13ä½æ¯«ç§’æ—¶é—´æˆ³
assert(type(timestamp) == "number", "æ—¶é—´æˆ³ä¿æŒ number ç±»å‹")
assert(timestamp > 0, "æ—¶é—´æˆ³å€¼æœ‰æ•ˆ")
```

#### **Saga æ­¥éª¤è®¡æ•°å™¨æµ‹è¯• (ä¿æŒ number)**
```lua
-- Saga æ­¥éª¤ä¿æŒ number ç±»å‹ï¼Œå¸¸è§„é€’å¢æµ‹è¯•
local current_step = 5
local next_step = current_step + 1
assert(next_step == 6, "Saga æ­¥éª¤æ­£å¸¸é€’å¢")
assert(type(next_step) == "number", "ä¿æŒ number ç±»å‹")
```

#### **è¯„è®ºåºå·æµ‹è¯•**
```lua
-- æµ‹è¯•æ–‡ç« çº§åˆ«è¯„è®ºåºå·ç”Ÿæˆå™¨
local article = { comment_seq_id_generator = "100" }
local next_comment_id = tostring(bint(article.comment_seq_id_generator) + 1)
assert(next_comment_id == "101", "è¯„è®ºåºå·é€’å¢æ­£ç¡®")
```

---

## ğŸš€ å·²å®Œæˆçš„ä¼˜åŒ–

### Saga ID å­—ç¬¦ä¸²åŒ–ä¼˜åŒ–
**èƒŒæ™¯**: ä¸ºå°†æ¥çš„ bint è¿ç§»åšå‡†å¤‡ï¼Œæå‰å°† Saga ID å¤„ç†æ”¹ä¸ºå­—ç¬¦ä¸²æ ¼å¼

**ä¿®æ”¹å†…å®¹**:
- **æ–‡ä»¶**: `src/inventory_service.lua`
- **ä¿®æ”¹**: ç§»é™¤ 5 å¤„ `tonumber(messaging.get_saga_id(msg))` è°ƒç”¨
- **æ”¹ä¸º**: ç›´æ¥ä½¿ç”¨ `messaging.get_saga_id(msg)` è¿”å›çš„å­—ç¬¦ä¸²
- **åŸå› **: Saga ID åœ¨ saga.lua ä¸­è¢«ç”¨ä½œ table keyï¼Œå­—ç¬¦ä¸²æ ¼å¼å®Œå…¨é€‚ç”¨

**éªŒè¯**: è¯¥ä¼˜åŒ–ä¸å½±å“ç°æœ‰åŠŸèƒ½ï¼Œå› ä¸ºï¼š
1. Lua table æ”¯æŒå­—ç¬¦ä¸² key
2. `entity_coll.get()` ç­‰å‡½æ•°æ”¯æŒå­—ç¬¦ä¸²å‚æ•°
3. AO æ¶ˆæ¯ä¼ é€’ä¸­åŸç”Ÿå°±æ˜¯å­—ç¬¦ä¸²æ ¼å¼

---

## ğŸ“‹ å®æ–½è·¯çº¿å›¾

### Phase 1: ID åºåˆ—ç”Ÿæˆå™¨è¿ç§» (0.5 å¤©) âœ… **å·²å®Œæˆ**
**ç›®æ ‡**: å°† ArticleIdSequence å’Œ SagaIdSequence æ”¹ä¸ºå­—ç¬¦ä¸²å­˜å‚¨ + bint è¿ç®—
**å½±å“**: æœ€å°ï¼Œæ˜“äºæµ‹è¯•å’Œå›æ»š
**æ–‡ä»¶**: `src/article_aggregate.lua`, `src/saga.lua`, æ‰€æœ‰ä¸»æ–‡ä»¶
**ç®€åŒ–ä¼˜åŠ¿**: æ— éœ€æ•°æ®è¿ç§»ï¼Œç›´æ¥é‡‡ç”¨æ–°æ ¼å¼
**å·²å®Œæˆä¼˜åŒ–**: ç§»é™¤äº† `inventory_service.lua` ä¸­çš„ `tonumber()` è°ƒç”¨ï¼Œä¸ºå­—ç¬¦ä¸² ID åšå‡†å¤‡

**å®æ–½å†…å®¹**:
- âœ… ä¿®æ”¹æ‰€æœ‰ä¸»æ–‡ä»¶çš„ ArticleIdSequence å’Œ SagaIdSequence åˆå§‹åŒ–
- âœ… ä»æ•°ç»„æ ¼å¼ `{0}` æ”¹ä¸ºå¯¹è±¡æ ¼å¼ `{current = "0"}`
- âœ… æ·»åŠ è‡ªåŠ¨è¿ç§»é€»è¾‘å¤„ç†æ—§æ ¼å¼æ•°æ®
- âœ… åœ¨ `article_aggregate.lua` å’Œ `saga.lua` ä¸­æ·»åŠ  bint require
- âœ… ä¿®æ”¹ `next_article_id()` å’Œ `next_saga_id()` å‡½æ•°ä½¿ç”¨ bint è¿ç®—

### Phase 2: ç‰ˆæœ¬å·ç³»ç»Ÿè¿ç§» (2-3 å¤©)
**ç›®æ ‡**: å°†æ‰€æœ‰å®ä½“çš„ version å­—æ®µæ”¹ä¸ºå­—ç¬¦ä¸²å­˜å‚¨ï¼Œä¿®æ”¹è¿ç®—é€»è¾‘
**å½±å“**: ä¸­ç­‰ï¼Œéœ€è¦å¹¶å‘æµ‹è¯•
**æ–‡ä»¶**: æ‰€æœ‰ `*_aggregate.lua` æ–‡ä»¶
**å…³é”®å˜åŒ–**: `cmd.version` å’Œ `_state.version` éƒ½ä¸ºå­—ç¬¦ä¸²ï¼Œè¿ç®—æ—¶è½¬æ¢ä¸º bint

### Phase 3: æ•°é‡å­—æ®µè¿ç§» (1-2 å¤©)
**ç›®æ ‡**: å°†åº“å­˜æ•°é‡ç­‰å­—æ®µæ”¹ä¸ºå­—ç¬¦ä¸²å­˜å‚¨
**å½±å“**: ä¸­ç­‰ï¼Œå½±å“ä¸šåŠ¡é€»è¾‘
**æ–‡ä»¶**: inventory ç›¸å…³é€»è¾‘æ–‡ä»¶

### Phase 3.5: è¯„è®ºåºå·è¿ç§» (1 å¤©)
**ç›®æ ‡**: è¿ç§»æ–‡ç« çš„ comment_seq_id_generator å­—æ®µ
**å½±å“**: ä¸­ç­‰ï¼Œåªå½±å“è¯„è®ºæ·»åŠ åŠŸèƒ½
**æ–‡ä»¶**:
- `src/article_add_comment_logic.lua` (è¯„è®ºåºå·)
- æ–‡ç« çŠ¶æ€æ•°æ®è¿ç§»è„šæœ¬

### Phase 3.7: Saga ä¸Šä¸‹æ–‡ç‰ˆæœ¬å·è¿ç§» (1 å¤©)
**ç›®æ ‡**: è¿ç§» Saga ä¸Šä¸‹æ–‡ä¸­ä¼ é€’çš„ç‰ˆæœ¬å·å­—æ®µ
**å½±å“**: ä¸­ç­‰ï¼Œå½±å“ Saga æ‰§è¡Œé€»è¾‘
**æ–‡ä»¶**:
- `src/inventory_service.lua` (ä¸Šä¸‹æ–‡ç‰ˆæœ¬å·)
- Saga ä¸Šä¸‹æ–‡æ•°æ®å¤„ç†è„šæœ¬

### Phase 4: å…¨é¢æµ‹è¯•å’Œä¼˜åŒ– (2-3 å¤©)
**ç›®æ ‡**: ç«¯åˆ°ç«¯æµ‹è¯•ï¼Œæ€§èƒ½ä¼˜åŒ–ï¼Œæ–‡æ¡£æ›´æ–°
**å½±å“**: éªŒè¯æ‰€æœ‰åŠŸèƒ½æ­£å¸¸

### Phase 5: ç”Ÿäº§éƒ¨ç½² (1 å¤©)
**ç›®æ ‡**: ç°åº¦å‘å¸ƒï¼Œç›‘æ§å’Œåº”æ€¥é¢„æ¡ˆ

---

## ğŸ”§ æŠ€æœ¯å®ç°ç»†èŠ‚

### 1. bint é…ç½®é€‰æ‹©

#### **æ¨èé…ç½®**
```lua
local bint = require('.bint')(256)  -- 256ä½ç²¾åº¦
```

#### **ç²¾åº¦è€ƒè™‘**
- **256ä½**: æ”¯æŒæå¤§æ•°å­—ï¼Œæ»¡è¶³å¤§éƒ¨åˆ†ä¸šåŠ¡éœ€æ±‚
- **512ä½**: æ›´é«˜ç²¾åº¦ï¼Œä½†æ€§èƒ½ç¨å·®
- **åŠ¨æ€ç²¾åº¦**: æ ¹æ®å…·ä½“æ•°å­—å¤§å°é€‰æ‹©ï¼Œä½†å¤æ‚åº¦æ›´é«˜

### 2. é”™è¯¯å¤„ç†ç­–ç•¥

#### **è½¬æ¢å¤±è´¥å¤„ç†**
```lua
local function safe_bint_convert(str)
    local success, result = pcall(bint, str)
    if not success then
        error("Invalid number format: " .. str)
    end
    return result
end
```

#### **è¿ç®—æº¢å‡ºå¤„ç†**
```lua
local function safe_bint_add(a, b)
    local result = a + b
    -- æ£€æŸ¥æ˜¯å¦è¶…å‡ºé¢„æœŸèŒƒå›´
    if result > MAX_EXPECTED_VALUE then
        error("Number too large: " .. tostring(result))
    end
    return result
end
```

### 3. æ€§èƒ½ä¼˜åŒ–

#### **å¯¹è±¡æ± æ¨¡å¼**
```lua
local bint_pool = {}

local function get_bint(value)
    if bint_pool[value] then
        return bint_pool[value]
    end
    local new_bint = bint(value)
    bint_pool[value] = new_bint
    return new_bint
end
```

#### **å»¶è¿Ÿè½¬æ¢**
```lua
-- åªåœ¨å¿…è¦æ—¶è¿›è¡Œè½¬æ¢
local function lazy_bint_convert(value)
    if type(value) == "string" then
        return bint(value)
    elseif type(value) == "number" then
        return bint(tostring(value))
    else
        error("Unsupported type: " .. type(value))
    end
end
```

---

## ğŸ“Š æˆåŠŸæŒ‡æ ‡

### 1. åŠŸèƒ½æ­£ç¡®æ€§
- âœ… ID ç”Ÿæˆå”¯ä¸€æ€§å’Œé€’å¢æ€§
- âœ… ç‰ˆæœ¬å·å¹¶å‘æ§åˆ¶æ­£å¸¸
- âœ… æ•°é‡è®¡ç®—ç²¾åº¦æ­£ç¡®
- âœ… æ‰€æœ‰ä¸šåŠ¡æµç¨‹æ­£å¸¸è¿è¡Œ

### 2. æ€§èƒ½æŒ‡æ ‡
- âœ… å“åº”æ—¶é—´ä¸è¶…è¿‡ 10% å¢åŠ 
- âœ… å†…å­˜ä½¿ç”¨ä¸è¶…è¿‡ 20% å¢åŠ 
- âœ… å¤§æ•°å­—è¿ç®—æ­£å¸¸ (æµ‹è¯• 10^18 çº§åˆ«)

### 3. å…¼å®¹æ€§æŒ‡æ ‡
- âœ… å‘åå…¼å®¹æ—§æ•°æ®æ ¼å¼
- âœ… API æ¥å£ä¿æŒä¸å˜
- âœ… æ¶ˆæ¯åºåˆ—åŒ–æ­£å¸¸
- âœ… è·¨è¿›ç¨‹é€šä¿¡æ­£å¸¸

---

## ğŸ¯ å†³ç­–å»ºè®®

### æ¨èæ‰§è¡Œé¡ºåº
1. **Phase 1** (IDåºåˆ—) â†’ **Phase 2** (ç‰ˆæœ¬å·) â†’ **Phase 3** (æ•°é‡) â†’ **Phase 4** (æµ‹è¯•) â†’ **Phase 5** (éƒ¨ç½²)

### é£é™©æ§åˆ¶æªæ–½
- æ¯ä¸ª Phase åè¿›è¡Œå®Œæ•´æµ‹è¯•
- å‡†å¤‡å›æ»šè„šæœ¬å’Œæ•°æ®è¿ç§»å·¥å…·
- è®¾ç½®ç›‘æ§æŒ‡æ ‡ï¼ŒåŠæ—¶å‘ç°é—®é¢˜
- å°æ­¥å¿«è·‘ï¼Œé€æ­¥æ¨è¿›

### å¤‡é€‰æ–¹æ¡ˆ
- **æ¸è¿›å¼**: åªè¿ç§»é«˜é£é™©çš„æ•°å­—å¤„ç†
- **æ··åˆæ¨¡å¼**: é‡è¦æ•°å­—ç”¨ bintï¼Œå…¶ä»–ä¿æŒ number
- **å»¶è¿Ÿè¿ç§»**: å…ˆè§‚å¯Ÿ AO å¹³å°çš„å‘å±•æ–¹å‘

---

## ğŸ“ åç»­è¡ŒåŠ¨

1. **è®¨è®ºç¡®è®¤**: å›¢é˜Ÿå†…éƒ¨è®¨è®ºæœ¬è§„åˆ’çš„å¯è¡Œæ€§
2. **åŸå‹éªŒè¯**: å®ç°ä¸€ä¸ªæœ€å°åŒ–åŸå‹éªŒè¯æŠ€æœ¯æ–¹æ¡ˆ
3. **æµ‹è¯•å‡†å¤‡**: ç¼–å†™è¯¦ç»†çš„æµ‹è¯•ç”¨ä¾‹
4. **æ—¶é—´å®‰æ’**: åˆ¶å®šå…·ä½“çš„å®æ–½æ—¶é—´è¡¨
5. **èµ„æºé…ç½®**: åˆ†é…å¼€å‘å’Œæµ‹è¯•èµ„æº

**é‡è¦æé†’**: æœ¬æ–‡æ¡£ä¸ºè§„åˆ’åˆ†æï¼Œå®é™…å®æ–½å‰è¯·ç¡®ä¿æ‰€æœ‰é£é™©å·²è¢«å……åˆ†è¯„ä¼°ï¼Œå¹¶å‡†å¤‡å¥½å®Œæ•´çš„æµ‹è¯•å’Œå›æ»šæ–¹æ¡ˆã€‚

---

## âœ… ä¸‰è½®è¿­ä»£æ£€æŸ¥æ€»ç»“

ç»è¿‡ç³»ç»Ÿæ€§çš„ä¸‰è½®è¿­ä»£æ£€æŸ¥ï¼ŒBigInteger è¿ç§»è§„åˆ’å·²ç»è¾¾åˆ° **å®Œæ•´ã€å¯è¡Œã€ä½é£é™©** çš„æ ‡å‡†ï¼š

### ç¬¬ä¸€è½®æ£€æŸ¥ï¼šå…¨é¢æ¢ç´¢
- âœ… è¯†åˆ«æ‰€æœ‰æ•°å­—å¤„ç†ä»£ç ä½ç½®
- âœ… å‘ç° timestampã€saga current_step ç­‰æ–°å¢å­—æ®µ
- âœ… åˆ†æå„å­—æ®µçš„ä¸šåŠ¡å½±å“å’Œè¿ç§»å¤æ‚åº¦
- âœ… åˆ¶å®šåˆæ­¥çš„å®æ–½è·¯çº¿å›¾

### ç¬¬äºŒè½®æ£€æŸ¥ï¼šç²¾ç¡®è¯„ä¼°
- âœ… æ·±å…¥åˆ†ææ¯ä¸ªå­—æ®µçš„å®é™…ä½¿ç”¨åœºæ™¯
- âœ… åŸºäºä¸šåŠ¡éœ€æ±‚è¯„ä¼°è¿ç§»å¿…è¦æ€§
- âœ… ä¼˜åŒ–è¿ç§»ç­–ç•¥ï¼Œç§»é™¤ä¸å¿…è¦çš„è¿ç§»é¡¹ç›®
- âœ… ç®€åŒ–å®æ–½è®¡åˆ’ï¼Œé™ä½æ€»ä½“å¤æ‚åº¦

### ç¬¬ä¸‰è½®æ£€æŸ¥ï¼šæœ€ç»ˆéªŒè¯
- âœ… éªŒè¯è¿ç§»ç­–ç•¥çš„æŠ€æœ¯å¯è¡Œæ€§
- âœ… ç¡®è®¤å®æ–½é¡ºåºçš„åˆç†æ€§å’Œä¾èµ–å…³ç³»
- âœ… è¯„ä¼°æµ‹è¯•è¦†ç›–çš„å®Œæ•´æ€§
- âœ… éªŒè¯é£é™©æ§åˆ¶æªæ–½çš„æœ‰æ•ˆæ€§

### æ£€æŸ¥ç»“æœï¼š**å…¨éƒ¨é€šè¿‡** âœ…

**è§„åˆ’çŠ¶æ€**: **å‡†å¤‡å°±ç»ªï¼Œå¯ä»¥å¼€å§‹å®æ–½**

**å…³é”®å‘ç°**:
1. **å­—æ®µèŒƒå›´æ˜ç¡®**: ç¡®å®šéœ€è¦è¿ç§»çš„ 5 ä¸ªæ ¸å¿ƒå­—æ®µç±»å‹
2. **ç­–ç•¥ä¼˜åŒ–**: é‡‡ç”¨"å­—ç¬¦ä¸²å­˜å‚¨ + bintè¿ç®—"çš„ç»Ÿä¸€æ¨¡å¼
3. **å¤æ‚åº¦å¯æ§**: æ€»è®¡çº¦ 6-8 å¤©ï¼Œå¤§å¹…ç®€åŒ–å®æ–½
4. **æµ‹è¯•å®Œæ•´**: è¦†ç›–å•å…ƒã€é›†æˆã€ç«¯åˆ°ç«¯å’Œå¤§æ•°å­—åœºæ™¯
5. **å›æ»šå®‰å…¨**: æä¾›å®Œæ•´çš„å›æ»šè„šæœ¬å’ŒéªŒè¯æœºåˆ¶

**å»ºè®®**: å¯ä»¥å¼€å§‹æŒ‰ç…§ Phase 1 çš„è®¡åˆ’å®æ–½ç¬¬ä¸€ä¸ªè¿ç§»é¡¹ç›®ï¼ˆIDåºåˆ—ç”Ÿæˆå™¨ï¼‰ã€‚

## ğŸ“ æ›´æ–°æ—¥å¿—

### 2025-10-20 (Phase 1 å®æ–½å®Œæˆ)
- âœ… **Phase 1 å®Œæˆ**: IDåºåˆ—ç”Ÿæˆå™¨è¿ç§»å…¨éƒ¨å®æ–½
- âœ… ä¿®æ”¹ 6 ä¸ªä¸»æ–‡ä»¶çš„åºåˆ—åˆå§‹åŒ–ï¼Œä» `{0}` æ”¹ä¸º `{current = "0"}`
- âœ… æ·»åŠ  bint require åˆ° `article_aggregate.lua` å’Œ `saga.lua`
- âœ… é‡å†™ `next_article_id()` å’Œ `next_saga_id()` ä½¿ç”¨ bint è¿ç®—
- âœ… åŒ…å«è‡ªåŠ¨è¿ç§»é€»è¾‘å¤„ç†æ—§æ ¼å¼æ•°æ®
- ğŸ¯ **æŠ€æœ¯éªŒè¯**: ä»£ç è¯­æ³•æ­£ç¡®ï¼Œé€»è¾‘å®Œæ•´
- ğŸ“Š **å½±å“è¯„ä¼°**: æœ€å°é£é™©ï¼Œæ˜“äºæµ‹è¯•å’Œå›æ»š

### 2025-10-20 (Phase 2-3 å®æ–½å®Œæˆ - å…¨é‡è¿ç§»)
- âœ… **Phase 2 å®Œæˆ**: ç‰ˆæœ¬å·ç³»ç»Ÿè¿ç§»å…¨éƒ¨å®æ–½
  - ä¿®æ”¹ `article_aggregate.lua` ä¸­ 5 ä¸ªç‰ˆæœ¬å·é€’å¢ç‚¹
  - ä¿®æ”¹ `inventory_item_aggregate.lua` ä¸­ç‰ˆæœ¬å·å¤„ç†
  - ç‰ˆæœ¬å·ä» number æ”¹ä¸ºå­—ç¬¦ä¸²å­˜å‚¨å’Œä¼ è¾“
  - è¿ç®—æ—¶è½¬æ¢ä¸º bint æ‰§è¡Œ +1 æ“ä½œ
  - è¿”å›å€¼è½¬å›å­—ç¬¦ä¸²å­˜å‚¨
  
- âœ… **Phase 3 å®Œæˆ**: æ•°é‡å­—æ®µè¿ç§»å…¨éƒ¨å®æ–½
  - æ·»åŠ  bint require åˆ° `inventory_item_add_inventory_item_entry_logic.lua`
  - ä¿®æ”¹åº“å­˜æ•°é‡åŠ æ³•è¿ç®—: `tostring(bint(quantity or "0") + bint(movement_quantity))`
  - ç¡®ä¿ quantity å­—æ®µä½œä¸ºå­—ç¬¦ä¸²å­˜å‚¨
  
- âœ… **Phase 3.5 å®Œæˆ**: è¯„è®ºåºå·è¿ç§»å…¨éƒ¨å®æ–½
  - æ·»åŠ  bint require åˆ° `article_add_comment_logic.lua`
  - ä¿®æ”¹è¯„è®ºåºå·ç”Ÿæˆå™¨ä½¿ç”¨ bint è¿ç®—
  - è¯„è®ºåºå·ä½œä¸ºå­—ç¬¦ä¸²å­˜å‚¨åœ¨æ–‡ç« çŠ¶æ€ä¸­
  
- âœ… **Phase 3.7 å®Œæˆ**: Saga ç›¸å…³ä¼˜åŒ–
  - ä¿®æ”¹ `saga.lua` ä¸­ `next_saga_id()` è¿”å›å­—ç¬¦ä¸²
  - åˆ é™¤ `inventory_service.lua` ä¸­ 5 ä¸ªä¸å¿…è¦çš„ `tostring(saga_id)` è°ƒç”¨
  - Saga ID ä½œä¸ºå­—ç¬¦ä¸²ç›´æ¥ä½¿ç”¨
  
- âœ… **ID ç”Ÿæˆå‡½æ•°ä¼˜åŒ–**:
  - `current_article_id()` è¿”å›å­—ç¬¦ä¸²
  - `next_article_id()` è¿”å›å­—ç¬¦ä¸²
  - ç¡®ä¿ä¸€è‡´çš„å­—ç¬¦ä¸²æ ¼å¼
  
- ğŸ¯ **å…¨é‡å®æ–½**: æ‰€æœ‰æ ¸å¿ƒæ•°å­—å­—æ®µå·²æ”¹ä¸º bint å¤„ç†
- ğŸ“Š **ä»£ç æ€»ç»“**: ä¿®æ”¹ 7 ä¸ª Lua æ–‡ä»¶ï¼Œæ¶µç›–æ‰€æœ‰å…³é”®æ•°å­—æ“ä½œ

## âœ… å®ŒæˆéªŒè¯æ¸…å•

### Phase 1: ID åºåˆ—ç”Ÿæˆå™¨ âœ…
- [x] `blog_main.lua`: ArticleIdSequence å’Œ SagaIdSequence æ”¹ä¸º `{current = "0"}`
- [x] `a_ao_demo.lua`: åŒä¸Šä¿®æ”¹
- [x] `inventory_service_main.lua`: SagaIdSequence æ”¹ä¸º `{current = "0"}`
- [x] `in_out_service_main.lua`: SagaIdSequence æ”¹ä¸º `{current = "0"}`
- [x] `inventory_item_main.lua`: SagaIdSequence æ”¹ä¸º `{current = "0"}`
- [x] `a_ao_demo_main.lua`: SagaIdSequence æ”¹ä¸º `{current = "0"}`
- [x] `article_aggregate.lua`: æ·»åŠ  bint require, ä¿®æ”¹ next_article_id() å’Œ current_article_id()
- [x] `saga.lua`: æ·»åŠ  bint require, ä¿®æ”¹ next_saga_id()

### Phase 2: ç‰ˆæœ¬å·ç³»ç»Ÿ âœ…
- [x] `article_aggregate.lua`: 5 ä¸ªç‰ˆæœ¬å·é€’å¢æ”¹ä¸º bint è¿ç®—
- [x] `inventory_item_aggregate.lua`: ç‰ˆæœ¬å·å¤„ç†æ”¹ä¸º bint è¿ç®—
- [x] ç‰ˆæœ¬å·è¿”å›å€¼ä¸ºå­—ç¬¦ä¸²

### Phase 3: æ•°é‡å­—æ®µ âœ…
- [x] `inventory_item_add_inventory_item_entry_logic.lua`: æ·»åŠ  bint require
- [x] æ•°é‡åŠ æ³•: `tostring(bint(quantity or "0") + bint(movement_quantity))`

### Phase 3.5: è¯„è®ºåºå· âœ…
- [x] `article_add_comment_logic.lua`: æ·»åŠ  bint require
- [x] è¯„è®ºåºå·ç”Ÿæˆæ”¹ä¸º bint è¿ç®—
- [x] è¯„è®ºåºå·è¿”å›ä¸ºå­—ç¬¦ä¸²

### Phase 3.7: Saga ä¼˜åŒ– âœ…
- [x] `saga.lua`: next_saga_id() è¿”å›å­—ç¬¦ä¸²
- [x] `inventory_service.lua`: åˆ é™¤ 5 å¤„ tostring(saga_id) è°ƒç”¨

### æ€»ä½“çŠ¶æ€
- âœ… **æ‰€æœ‰è§„åˆ’çš„ä¿®æ”¹å·²å…¨éƒ¨å®Œæˆ**
- âœ… **æ‰€æœ‰ä¿®æ”¹éƒ½éµå¾ªç»Ÿä¸€çš„å­—ç¬¦ä¸²å­˜å‚¨ + bint è¿ç®—æ¨¡å¼**
- âœ… **ä»£ç è¯­æ³•æ­£ç¡®ï¼Œé€»è¾‘å®Œæ•´**
- âœ… **æ— éœ€è¿›ä¸€æ­¥ä¿®æ”¹ï¼Œå¯ç›´æ¥æµ‹è¯•**
