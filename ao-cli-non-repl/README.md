# AO CLI éREPLæ¨¡å¼

> **âš ï¸ é‡è¦æ›´æ–°**: AO CLI å·¥å…·å·²è¿ç§»åˆ°ç‹¬ç«‹çš„ä»£ç åº“ï¼
>
> **æ–°åœ°å€**: https://github.com/dddappp/ao-cli
> **npmåŒ…**: `@dddappp/ao-cli`

## ğŸ“¦ è¿ç§»çŠ¶æ€

AO CLI å·¥å…·å·²å®Œå…¨è¿ç§»åˆ°ç‹¬ç«‹ä»£ç åº“ï¼ŒåŒ…å«ï¼š

- âœ… **è‡ªåŒ…å«æµ‹è¯•å¥—ä»¶**: ç‹¬ç«‹çš„æµ‹è¯•åº”ç”¨ï¼Œä¸ä¾èµ–å¤–éƒ¨é¡¹ç›®
- âœ… **å®Œæ•´å‘½ä»¤æ”¯æŒ**: spawn, eval, load, message, inbox æ‰€æœ‰å‘½ä»¤
- âœ… **npmå‘å¸ƒå°±ç»ª**: å¯ä½œä¸ºç‹¬ç«‹åŒ…å‘å¸ƒå’Œå®‰è£…
- âœ… **æ–‡æ¡£å®Œå–„**: ç‹¬ç«‹çš„ä½¿ç”¨æ–‡æ¡£å’ŒAPIè¯´æ˜

## ğŸ  æ­¤ç›®å½•å†…å®¹

æ­¤ç›®å½•ä¿ç•™äº† A-AO-Demo é¡¹ç›®çš„å®Œæ•´æµ‹è¯•å¥—ä»¶ï¼ŒåŒ…æ‹¬åšå®¢åº”ç”¨æµ‹è¯•å’Œ SAGA è·¨è¿›ç¨‹æµ‹è¯•ï¼š

### æ–‡ä»¶ç»“æ„
```
ao-cli-non-repl/
â”œâ”€â”€ README.md           # æ­¤æ–‡æ¡£ - é¡¹ç›®æµ‹è¯•æ¦‚è§ˆå’Œå®Œæ•´ä½¿ç”¨æŒ‡å—
â””â”€â”€ tests/
    â”œâ”€â”€ run-blog-tests.sh           # åšå®¢åº”ç”¨è‡ªåŠ¨åŒ–æµ‹è¯•è„šæœ¬
    â”œâ”€â”€ run-saga-tests.sh           # SAGAè·¨è¿›ç¨‹è‡ªåŠ¨åŒ–æµ‹è¯•è„šæœ¬ â­
    â”œâ”€â”€ run-legacy-token-tests.sh   # Legacy Tokenè“å›¾åŠŸèƒ½æµ‹è¯•è„šæœ¬
    â”œâ”€â”€ ao-legacy-token-blueprint.lua    # Legacyç½‘ç»œå…¼å®¹çš„Tokenè“å›¾
    â”œâ”€â”€ ao-official-token-blueprint.lua  # AOå®˜æ–¹æ ‡å‡†Tokenè“å›¾
    â””â”€â”€ process_alice_1008.txt      # æµ‹è¯•è¿‡ç¨‹æ•°æ®è®°å½•
```

### æµ‹è¯•å¥—ä»¶åŠŸèƒ½

#### åšå®¢åº”ç”¨æµ‹è¯• (`run-blog-tests.sh`)
éªŒè¯åšå®¢åº”ç”¨çš„æ ¸å¿ƒåŠŸèƒ½ï¼š
- æ–‡ç« çš„åˆ›å»ºã€è¯»å–ã€æ›´æ–°æ“ä½œ
- è¯„è®ºç³»ç»ŸåŠŸèƒ½
- ç‰ˆæœ¬æ§åˆ¶å’Œä¹è§‚é”æœºåˆ¶
- Inbox æ¶ˆæ¯å¤„ç†æœºåˆ¶

> NOTE Inbox æœºåˆ¶ï¼šå½“ä¸€ä¸ªè¿›ç¨‹æ²¡æœ‰åŒ¹é…çš„ handler å¤„ç†æ¶ˆæ¯æ—¶ï¼Œæ¶ˆæ¯å°±ä¼šè¿›å…¥è¯¥è¿›ç¨‹çš„ Inbox ä¸­ã€‚
> ä»¥ DDDML å·¥å…·ä¸º*æ–¹æ³•*ç”Ÿæˆçš„ä»£ç æ¥è¯´ï¼Œæ¶ˆæ¯çš„ handlers é€šå¸¸éƒ½ä¼šå°†**å›å¤æ¶ˆæ¯**å‘é€ç»™è¯·æ±‚æ¶ˆæ¯çš„å‘é€è€…ï¼ˆ`From`ï¼‰ã€‚
> å¦‚æœè¦æƒ³è®©*æ–¹æ³•*çš„å›å¤æ¶ˆæ¯å‡ºç°åœ¨ä¸€ä¸ªè¿›ç¨‹ Inbox é‡Œï¼Œå¯ä»¥åœ¨è¯¥è¿›ç¨‹å†…ç”¨ eval çš„æ–¹å¼æ¥å‘é€è§¦å‘*æ–¹æ³•*æ‰§è¡Œï¼ˆå³è§¦å‘ Handler å¤„ç†ï¼‰çš„æ¶ˆæ¯ã€‚
> è¿™æ ·æ”¶åˆ°æ¶ˆæ¯çš„è¿›ç¨‹å°±ä¼šä»æ¶ˆæ¯çš„ From å­—æ®µä¸­çœ‹åˆ°å‘é€æ¶ˆæ¯çš„è¿›ç¨‹ IDï¼Œç„¶åå°†æ‰§è¡Œç»“æœå›å¤ç»™è¿™ä¸ª ID æŒ‡å‘çš„è¿›ç¨‹ã€‚
> å¦‚æœæ”¶åˆ°æ¶ˆæ¯çš„è¿›ç¨‹æ²¡æœ‰ handler å¯ä»¥å¤„ç†æ¶ˆæ¯ï¼Œæ¶ˆæ¯å°±ä¼šå‡ºç°åœ¨è¯¥è¿›ç¨‹çš„ Inbox ä¸­ã€‚

**æµ‹è¯•æµç¨‹**:
1. ç”Ÿæˆ AO è¿›ç¨‹å¹¶åŠ è½½åšå®¢åº”ç”¨ä»£ç 
2. æ‰§è¡Œæ–‡ç« å’Œè¯„è®ºçš„ CRUD æ“ä½œ
3. éªŒè¯ç‰ˆæœ¬æ§åˆ¶å’Œå¹¶å‘å®‰å…¨
4. æ£€æŸ¥ Inbox æ¶ˆæ¯å¤„ç†

#### SAGA è·¨è¿›ç¨‹æµ‹è¯• (`run-saga-tests.sh`) â­
éªŒè¯åˆ†å¸ƒå¼äº‹åŠ¡å¤„ç†èƒ½åŠ›ï¼š
- å¤šè¿›ç¨‹æ¶æ„ä¸‹çš„æ¶ˆæ¯åè°ƒ
- SAGA æ¨¡å¼çš„äº‹åŠ¡ç®¡ç†
- è·¨è¿›ç¨‹çš„çŠ¶æ€ä¸€è‡´æ€§
- é”™è¯¯å¤„ç†å’Œè¡¥å¿æœºåˆ¶

**ğŸ¯ æŠ€æœ¯äº®ç‚¹**: è¯¥è„šæœ¬éªŒè¯äº†æˆ‘ä»¬å¯¹AOå¹³å°Tagè¿‡æ»¤é—®é¢˜çš„è§£å†³æ–¹æ¡ˆã€‚é€šè¿‡å°†Sagaä¿¡æ¯åµŒå…¥Dataå­—æ®µè€ŒéTagsï¼Œç¡®ä¿äº†åˆ†å¸ƒå¼äº‹åŠ¡çš„å¯é æ‰§è¡Œã€‚

**å…³é”®æŠ€æœ¯çªç ´**:
- **DataåµŒå…¥ç­–ç•¥**ï¼šå°†Sagaä¿¡æ¯ä»Tagsç§»åˆ°Dataï¼Œç»•è¿‡AO Tagè¿‡æ»¤
- **è¯·æ±‚vså“åº”åŒºåˆ†**ï¼šè¯·æ±‚æ¶ˆæ¯åµŒå…¥`saga_id`+`response_action`ï¼Œå“åº”æ¶ˆæ¯åªåµŒå…¥`saga_id`
- **æ··åˆä½¿ç”¨Tagå’ŒData**ï¼šActionç”¨Tagï¼ˆä¸è¢«è¿‡æ»¤ï¼‰ï¼ŒSagaåè°ƒä¿¡æ¯ç”¨Data
- **éªŒè¯æˆæœ**ï¼šSAGAå®Œå…¨æˆåŠŸï¼Œåº“å­˜ä»100æ›´æ–°åˆ°119

**æµ‹è¯•æµç¨‹**:
1. ç”Ÿæˆ Alice å’Œ Bob ä¸¤ä¸ªç‹¬ç«‹è¿›ç¨‹
2. é…ç½®è¿›ç¨‹é—´é€šä¿¡ç›®æ ‡ï¼ˆBobè°ƒç”¨Aliceçš„æœåŠ¡ï¼‰
3. æ‰§è¡Œåº“å­˜è°ƒæ•´çš„ SAGA äº‹åŠ¡ï¼ˆDataåµŒå…¥Sagaä¿¡æ¯ä¼ é€’ï¼‰
4. éªŒè¯äº‹åŠ¡å®Œæˆå’Œæ•°æ®ä¸€è‡´æ€§ï¼ˆåº“å­˜æ•°é‡æ­£ç¡®æ›´æ–°ï¼‰


#### Legacy Token è“å›¾æµ‹è¯• (`run-legacy-token-tests.sh`)
æµ‹è¯•åŸºäºå®˜æ–¹Token Blueprintçš„legacyç½‘ç»œå…¼å®¹ç‰ˆæœ¬ï¼ŒåŒ…å«7ä¸ªæ ¸å¿ƒAPIï¼š
- Info, Balance, Balances, Transfer, Mint, Total-Supply
- éªŒè¯bintå¤§æ•´æ•°åº“çš„ç²¾ç¡®è®¡ç®—åŠŸèƒ½
- æµ‹è¯•Debit-Notice/Credit-Noticeé€šçŸ¥ç³»ç»Ÿ
- éªŒè¯legacyç½‘ç»œå…¼å®¹æ€§å’ŒInboxæœºåˆ¶
- æä¾›è¯¦ç»†çš„æµ‹è¯•æŠ¥å‘Šå’ŒåŠŸèƒ½éªŒè¯

**è¸©å‘ç»éªŒæ€»ç»“**:
- eval + Sendè·¨è¿›ç¨‹é€šä¿¡ç¡®å®å·¥ä½œï¼ŒFrom='Unknown'ä¸å½±å“æ¶ˆæ¯ä¼ é€’
- Inboxç›¸å¯¹å˜åŒ–æ£€æµ‹æ¯”ç»å¯¹é•¿åº¦é¢„æµ‹æ›´å¯é 
- AOç½‘ç»œå»¶è¿Ÿå¤§ï¼Œè·¨è¿›ç¨‹å“åº”å¯èƒ½éœ€è¦10-30ç§’
- ao-cli inboxä¼šå½±å“Inboxé•¿åº¦ï¼Œä¸èƒ½ç”¨äºé•¿åº¦æŸ¥è¯¢
- åˆçº¦è¿›ç¨‹å¯ä»¥æˆåŠŸæŸ¥è¯¢å…¶ä»–åˆçº¦ï¼Œæ— éœ€å¤–éƒ¨å®¢æˆ·ç«¯

## ğŸš€ ä½¿ç”¨è¯´æ˜

### è·å–ç‹¬ç«‹çš„ AO CLI å·¥å…·

è¦ä½¿ç”¨ AO CLI å·¥å…·ï¼Œè¯·è®¿é—®æ–°çš„ç‹¬ç«‹ä»£ç åº“ï¼š

```bash
# å…‹éš†ç‹¬ç«‹ä»£ç åº“
git clone https://github.com/dddappp/ao-cli.git
cd ao-cli

# å®‰è£…å’Œè®¾ç½®
npm install
npm link

# éªŒè¯å®‰è£…
ao-cli --version
```

### åœ¨ A-AO-Demo é¡¹ç›®ä¸­è¿è¡Œæµ‹è¯•

æ­¤ç›®å½•çš„æµ‹è¯•å¥—ä»¶ä¸“é—¨ç”¨äºéªŒè¯ A-AO-Demo é¡¹ç›®çš„å®Œæ•´åŠŸèƒ½ï¼š

```bash
# åšå®¢åº”ç”¨æµ‹è¯• - éªŒè¯åŸºç¡€åŠŸèƒ½å’ŒInboxæœºåˆ¶
./ao-cli-non-repl/tests/run-blog-tests.sh

# SAGAè·¨è¿›ç¨‹æµ‹è¯• - éªŒè¯åˆ†å¸ƒå¼äº‹åŠ¡ â­
./ao-cli-non-repl/tests/run-saga-tests.sh

# Legacy Tokenè“å›¾æµ‹è¯• - éªŒè¯tokenåŠŸèƒ½å’ŒInboxæœºåˆ¶
./ao-cli-non-repl/tests/run-legacy-token-tests.sh

# å¸¦è‡ªå®šä¹‰å‚æ•°çš„æµ‹è¯•
AO_WAIT_TIME=5 AO_SAGA_WAIT_TIME=15 ./ao-cli-non-repl/tests/run-saga-tests.sh

# æ¨¡æ‹Ÿè¿è¡Œï¼ˆéªŒè¯è„šæœ¬é€»è¾‘ï¼‰
AO_DRY_RUN=true ./ao-cli-non-repl/tests/run-saga-tests.sh
```

#### ç¯å¢ƒå‡†å¤‡

è¿è¡Œæµ‹è¯•å‰è¯·ç¡®ä¿ï¼š
- å®‰è£…äº† AO CLI å·¥å…·ï¼ˆè§ä¸Šæ–‡ï¼‰
- A-AO-Demo é¡¹ç›®ä»£ç å®Œæ•´
- aos è¿›ç¨‹æ­£åœ¨è¿è¡Œ
- ç½‘ç»œä»£ç†ï¼ˆå¦‚éœ€è¦ï¼Œè¯¦è§è„šæœ¬æ³¨é‡Šï¼‰

#### æµ‹è¯•è¦†ç›–

- âœ… **è¿›ç¨‹ç®¡ç†**: è‡ªåŠ¨ç”Ÿæˆã€é…ç½®ã€æ¸…ç† AO è¿›ç¨‹
- âœ… **ä»£ç åŠ è½½**: åŠ¨æ€åŠ è½½å’ŒéªŒè¯ Lua ä»£ç 
- âœ… **æ¶ˆæ¯ä¼ é€’**: è¿›ç¨‹å†…å’Œè·¨è¿›ç¨‹æ¶ˆæ¯ä¼ é€’
- âœ… **Inboxæœºåˆ¶**: Send() â†’ sleep â†’ Inbox[#Inbox] å®Œæ•´æµç¨‹éªŒè¯
- âœ… **ä¸šåŠ¡é€»è¾‘**: åšå®¢åº”ç”¨ã€åº“å­˜ç®¡ç†å’ŒTokenåŠŸèƒ½
- âœ… **åˆ†å¸ƒå¼äº‹åŠ¡**: SAGA æ¨¡å¼å’Œæœ€ç»ˆä¸€è‡´æ€§ä¿è¯
- âœ… **é”™è¯¯å¤„ç†**: è¶…æ—¶ã€é‡è¯•å’Œæ•…éšœæ¢å¤æœºåˆ¶
- âœ… **è·¨è¿›ç¨‹é€šä¿¡**: åˆçº¦é—´çš„ç›´æ¥æŸ¥è¯¢å’Œå“åº”å¤„ç†

## ğŸ“‹ æµ‹è¯•ç”¨ä¾‹è¯¦ç»†æµç¨‹

### åšå®¢åº”ç”¨æµ‹è¯•æµç¨‹
`run-blog-tests.sh` æ‰§è¡Œå®Œæ•´çš„åšå®¢åº”ç”¨åŠŸèƒ½æµ‹è¯•ï¼š

1. **ç”Ÿæˆ AO è¿›ç¨‹** (`ao-cli spawn`)
2. **åŠ è½½åšå®¢åº”ç”¨ä»£ç ** (`ao-cli load`)
3. **è·å–æ–‡ç« åºå·** (`ao-cli message` + Inboxæ£€æŸ¥)
4. **åˆ›å»ºæ–‡ç« ** (`ao-cli message` + Inboxæ£€æŸ¥)
5. **è·å–æ–‡ç« ** (`ao-cli message` + Inboxæ£€æŸ¥)
6. **æ›´æ–°æ–‡ç« ** (`ao-cli message` + Inboxæ£€æŸ¥)
7. **æ›´æ–°æ­£æ–‡** (`ao-cli message` + Inboxæ£€æŸ¥)
8. **æ·»åŠ è¯„è®º** (`ao-cli message` + Inboxæ£€æŸ¥)

### SAGA è·¨è¿›ç¨‹æµ‹è¯•æµç¨‹ â­
`run-saga-tests.sh` å®ç°å¤šè¿›ç¨‹åˆ†å¸ƒå¼äº‹åŠ¡æµ‹è¯•ï¼š

1. **ç”ŸæˆèšåˆæœåŠ¡è¿›ç¨‹** (`ao-cli spawn`)
2. **åŠ è½½èšåˆå’Œå‡ºå…¥åº“æœåŠ¡ä»£ç ** (`ao-cli load`)
3. **ç”Ÿæˆä¸šåŠ¡æœåŠ¡è¿›ç¨‹** (`ao-cli spawn`)
4. **åŠ è½½ä¸šåŠ¡æœåŠ¡ä»£ç ** (`ao-cli load`)
5. **åŠ¨æ€é…ç½®è¿›ç¨‹é—´é€šä¿¡** (`ao-cli eval`)
6. **åˆ›å»ºæµ‹è¯•æ•°æ®** (`ao-cli message`)
7. **æ‰§è¡Œ SAGA äº‹åŠ¡** (`ao-cli eval`)
8. **éªŒè¯æ‰§è¡Œç»“æœ** (åº“å­˜æ›´æ–°å’Œäº‹åŠ¡çŠ¶æ€)

### Legacy Token æµ‹è¯•ç¯å¢ƒå˜é‡
```bash
# æ¨¡æ‹Ÿè¿è¡Œï¼ˆä¸è¿æ¥ç½‘ç»œï¼‰
AO_DRY_RUN=true ./ao-cli-non-repl/tests/run-legacy-token-tests.sh

# è‡ªå®šä¹‰ç­‰å¾…æ—¶é—´
AO_WAIT_TIME=5 AO_SAGA_WAIT_TIME=30 ./ao-cli-non-repl/tests/run-legacy-token-tests.sh
```

**ç¯å¢ƒå˜é‡è¯´æ˜**ï¼š
- `AO_DRY_RUN=true` - æ¨¡æ‹Ÿæ¨¡å¼ï¼ŒéªŒè¯è„šæœ¬é€»è¾‘è€Œä¸è¿æ¥AOç½‘ç»œ
- `AO_PROJECT_ROOT=/path/to/project` - æŒ‡å®šé¡¹ç›®æ ¹ç›®å½•
- `AO_WAIT_TIME=5` - è®¾ç½®æ™®é€šæ“ä½œç­‰å¾…æ—¶é—´
- `AO_SAGA_WAIT_TIME=30` - è®¾ç½®Sagaæ‰§è¡ŒåŸºç¡€ç­‰å¾…æ—¶é—´
- `AO_MAX_SAGA_WAIT_TIME=300` - è®¾ç½®Sagaæ‰§è¡Œæœ€å¤§ç­‰å¾…æ—¶é—´ï¼ˆç§’ï¼‰
- `AO_CHECK_INTERVAL=30` - è®¾ç½®SagaçŠ¶æ€æ£€æŸ¥é‡è¯•é—´éš”ï¼ˆç§’ï¼‰


### æ ¸å¿ƒéªŒè¯æœºåˆ¶

#### Inbox æ¶ˆæ¯å¤„ç†
- **Send() â†’ sleep â†’ Inbox[#Inbox]**: å®Œæ•´çš„æ¶ˆæ¯ç”Ÿå‘½å‘¨æœŸéªŒè¯
- **ç›¸å¯¹å˜åŒ–æ£€æµ‹**: æ¯”ç»å¯¹é•¿åº¦é¢„æµ‹æ›´å¯é çš„éªŒè¯ç­–ç•¥
- **è·¨è¿›ç¨‹å“åº”**: åˆçº¦é—´ç›´æ¥æŸ¥è¯¢çš„Inboxå“åº”å¤„ç†

#### è·¨è¿›ç¨‹é€šä¿¡æ¶æ„
- **è¿›ç¨‹é—´æ¶ˆæ¯ä¼ é€’**: eval + Sendè·¨è¿›ç¨‹é€šä¿¡æœºåˆ¶éªŒè¯
- **From='Unknown'å¤„ç†**: è·¨è¿›ç¨‹è°ƒç”¨ä¸­çš„å‘é€è€…æ ‡è¯†å¤„ç†
- **ç½‘ç»œå»¶è¿Ÿé€‚åº”**: AOç½‘ç»œå»¶è¿Ÿçš„è¶…æ—¶å’Œé‡è¯•ç­–ç•¥
- **äº‹åŠ¡åè°ƒ**: SAGAæ¨¡å¼çš„åˆ†å¸ƒå¼çŠ¶æ€åŒæ­¥

**å…³é”®æŠ€æœ¯å‘ç°**: AOå¹³å°æ”¯æŒå®Œæ•´çš„è¿›ç¨‹é—´é€šä¿¡ï¼Œåˆçº¦è¿›ç¨‹å¯ä»¥ç›´æ¥æŸ¥è¯¢å…¶ä»–åˆçº¦ï¼Œæ— éœ€å¤–éƒ¨å®¢æˆ·ç«¯ä»‹å…¥ã€‚

## ğŸ“– ç›¸å…³æ–‡æ¡£

- **AO CLI ç‹¬ç«‹ç‰ˆæœ¬**: https://github.com/dddappp/ao-cli
- **A-AO-Demo é¡¹ç›®**: å½“å‰é¡¹ç›®æ ¹ç›®å½•çš„ README.md
- **AO å®˜æ–¹æ–‡æ¡£**: https://ao.arweave.dev/

## ğŸ”— è¿ç§»å†å²å’Œé¡¹ç›®è¿›å±•

æ­¤ç›®å½•åŸæœ¬åŒ…å«å®Œæ•´çš„ AO CLI å·¥å…·å®ç°ï¼Œç°å·²è¿ç§»è‡³ç‹¬ç«‹ä»£ç åº“ã€‚ä¿ç•™çš„æµ‹è¯•å¥—ä»¶ä¸“æ³¨äºéªŒè¯ A-AO-Demo é¡¹ç›®çš„æ ¸å¿ƒåŠŸèƒ½ï¼Œç‰¹åˆ«æ˜¯å¤æ‚çš„åˆ†å¸ƒå¼äº‹åŠ¡åœºæ™¯ã€‚

### æœ€æ–°è¿›å±•
- âœ… **SAGA è·¨è¿›ç¨‹æµ‹è¯•**: æ–°å¢å®Œæ•´çš„åˆ†å¸ƒå¼äº‹åŠ¡è‡ªåŠ¨åŒ–æµ‹è¯•
- âœ… **Inbox æœºåˆ¶éªŒè¯**: æ·±åº¦æµ‹è¯• AO çš„æ¶ˆæ¯å¤„ç†æœºåˆ¶
- âœ… **å¤šè¿›ç¨‹æ¶æ„**: éªŒè¯è·¨è¿›ç¨‹é€šä¿¡å’ŒçŠ¶æ€åŒæ­¥
- âœ… **åŠ¨æ€é…ç½®**: è¿è¡Œæ—¶å‚æ•°è®¾ç½®å’Œç¯å¢ƒé€‚åº”æ€§

è¿™äº›æµ‹è¯•ç¡®ä¿ A-AO-Demo é¡¹ç›®ä½œä¸º AO å¹³å°å¤æ‚åº”ç”¨çš„å®Œæ•´å‚è€ƒå®ç°ï¼Œæ¶µç›–ä»åŸºç¡€CRUDåˆ°åˆ†å¸ƒå¼äº‹åŠ¡çš„å…¨åŠŸèƒ½éªŒè¯ã€‚


## ğŸ”§ èƒŒæ™¯çŸ¥è¯†ï¼šAO Tag è¿‡æ»¤é—®é¢˜è§£å†³æ–¹æ¡ˆ

### ğŸ¯ é—®é¢˜èƒŒæ™¯
AOç³»ç»Ÿä¼šå¯¹æ¶ˆæ¯Tagsè¿›è¡Œè¿‡æ»¤ï¼Œå¯¼è‡´Sagaæ¡†æ¶ä¾èµ–çš„è‡ªå®šä¹‰Tagï¼ˆå¦‚`X-SagaId`ã€`X-ResponseAction`ï¼‰åœ¨è·¨è¿›ç¨‹ä¼ é€’æ—¶ä¸¢å¤±ï¼Œç ´åäº†åˆ†å¸ƒå¼äº‹åŠ¡çš„åè°ƒæœºåˆ¶ã€‚

### âœ… è§£å†³æ–¹æ¡ˆ
é€šè¿‡æ·±å…¥åˆ†æAO/AOSæºç å’Œç³»ç»Ÿæµ‹è¯•ï¼Œæˆ‘ä»¬å®ç°äº†**DataåµŒå…¥ç­–ç•¥**ï¼š
- å°†Sagaç›¸å…³ä¿¡æ¯ä»Tagsç§»åŠ¨åˆ°Dataå­—æ®µ
- ä½¿ç”¨`messaging.embed_saga_info_in_data()`å‡½æ•°å®‰å…¨åµŒå…¥
- ä½¿ç”¨`messaging.get_saga_id()`å‡½æ•°å¯é æå–
- **å…³é”®å‘ç°**ï¼šåŒºåˆ†è¯·æ±‚å’Œå“åº”çš„Sagaä¿¡æ¯åµŒå…¥ç­–ç•¥
  - è¯·æ±‚æ¶ˆæ¯ï¼šåµŒå…¥`saga_id` + `response_action`
  - å“åº”æ¶ˆæ¯ï¼šåªåµŒå…¥`saga_id`ï¼ˆ`response_action`ä»…è®¾ç½®åœ¨`Tags.Action`ä¸­ï¼‰
- ç¡®ä¿ä¿¡æ¯åœ¨AOç³»ç»Ÿçš„Tagè¿‡æ»¤æœºåˆ¶ä¸‹ä»ç„¶å®Œæ•´ä¼ é€’

### ğŸ“Š éªŒè¯æˆæœ
- âœ… SAGAäº‹åŠ¡å®Œå…¨æˆåŠŸï¼ˆcurrent_step=6, completed=trueï¼‰
- âœ… åº“å­˜ç®¡ç†ä¸šåŠ¡é€»è¾‘æ­£ç¡®æ‰§è¡Œï¼ˆæ•°é‡ä»100æ›´æ–°åˆ°119ï¼‰
- âœ… è·¨è¿›ç¨‹é€šä¿¡æ­£å¸¸ï¼ˆaliceâ†”bobæ¶ˆæ¯ä¼ é€’æ— è¯¯ï¼‰
- âœ… DataåµŒå…¥ç­–ç•¥æœ‰æ•ˆï¼ˆç»•è¿‡AO Tagè¿‡æ»¤æœºåˆ¶ï¼‰

### ğŸ–ï¸ æŠ€æœ¯æ„ä¹‰
æ­¤è§£å†³æ–¹æ¡ˆä¸ºAOå¹³å°ä¸Šçš„å¤æ‚åˆ†å¸ƒå¼åº”ç”¨æä¾›äº†å¯é çš„æŠ€æœ¯åŸºç¡€ï¼Œç‰¹åˆ«æ˜¯å¯¹äºéœ€è¦è·¨è¿›ç¨‹åè°ƒçš„ä¸šåŠ¡åœºæ™¯ã€‚æ ¸å¿ƒç»éªŒï¼š
1. **Action tagä¸ä¼šè¢«è¿‡æ»¤**ï¼Œå¯ç”¨äºhandleråŒ¹é…
2. **è‡ªå®šä¹‰tagä¼šè¢«è¿‡æ»¤**ï¼Œå¿…é¡»ç”¨DataåµŒå…¥
3. **è¯·æ±‚å’Œå“åº”çš„Sagaä¿¡æ¯åµŒå…¥ç­–ç•¥ä¸åŒ**ï¼Œè¿™æ˜¯å…³é”®ç»†èŠ‚


## ğŸ”„ JSON è¾“å‡ºè§£ææ”¹è¿› - ä»è„†å¼±çš„æ­£åˆ™è¡¨è¾¾å¼åˆ°å¥å£®çš„ JSON è§£æ

### é—®é¢˜èƒŒæ™¯

æµ‹è¯•è„šæœ¬ `ao-cli-non-repl/tests/run-blog-tests.sh` ä¹‹å‰çš„ç‰ˆæœ¬ä½¿ç”¨è„†å¼±çš„æ­£åˆ™è¡¨è¾¾å¼ï¼ˆ`grep`ã€`sed`ã€`awk`ï¼‰æ¥è§£æ ao-cli çš„æ–‡æœ¬è¾“å‡ºï¼Œå­˜åœ¨ä»¥ä¸‹é—®é¢˜ï¼š
- **æ˜“å‡ºé”™**ï¼šè¾“å‡ºæ ¼å¼å˜åŒ–å¯¼è‡´è§£æå¤±è´¥
- **éš¾ç»´æŠ¤**ï¼šå¤æ‚çš„ sed/awk è¡¨è¾¾å¼éš¾ä»¥ç†è§£å’Œä¿®æ”¹
- **ç”Ÿæˆè¯¯æŠ¥**ï¼šæ—¥å¿—æ··å…¥ JSON å¯¼è‡´è§£æå¼‚å¸¸
- **ä½å¯é æ€§**ï¼šç‰¹æ®Šå­—ç¬¦å¤„ç†ä¸å½“å¯¼è‡´è¾¹ç•Œæƒ…å†µå¤±è´¥

### è§£å†³æ–¹æ¡ˆ

ä½¿ç”¨ ao-cli çš„ `--json` é€‰é¡¹è·å¾—ç»“æ„åŒ–çš„ JSON è¾“å‡ºï¼Œé€šè¿‡ `jq` è¿›è¡Œå¯é çš„è§£æï¼š

```bash
# âŒ è„†å¼±çš„æ–¹å¼ï¼ˆåŸæ¥çš„åšæ³•ï¼‰
PROCESS_ID=$(ao-cli spawn default --name "test" 2>/dev/null | grep "ğŸ“‹ Process ID:" | awk '{print $4}')
# é—®é¢˜ï¼šä¾èµ–äºè¾“å‡ºæ ¼å¼ï¼Œæ˜“ç¢

# âœ… å¥å£®çš„æ–¹å¼ï¼ˆæ”¹è¿›åï¼‰
JSON_OUTPUT=$(ao-cli spawn default --name "test" --json 2>/dev/null)
PROCESS_ID=$(echo "$JSON_OUTPUT" | jq -r '.data.processId')
# ä¼˜ç‚¹ï¼šç»“æ„åŒ–æ•°æ®ï¼Œå¯é æ€§é«˜
```

### å…³é”®æ”¹è¿›ç‚¹

#### 1. **Helper å‡½æ•°ç»Ÿä¸€å¤„ç†** - `run_ao_cli()`

```bash
run_ao_cli() {
    local command="$1"
    local process_id="$2"
    shift 2

    if [[ "$process_id" == -* ]]; then
        ao-cli "$command" -- "$process_id" --json "$@" 2>/dev/null
    else
        ao-cli "$command" "$process_id" --json "$@" 2>/dev/null
    fi
}
```

**ä¼˜ç‚¹**ï¼š
- æ‰€æœ‰ ao-cli è°ƒç”¨ç»Ÿä¸€ä½¿ç”¨ `--json` å’Œ `2>/dev/null`ï¼Œæ¶ˆé™¤æ—¥å¿—æ··å…¥é—®é¢˜
- å¤„ç†è¿›ç¨‹ ID ä»¥ `-` å¼€å¤´çš„ç‰¹æ®Šæƒ…å†µï¼ˆéœ€è¦ä½¿ç”¨ `--` åˆ†éš”ï¼‰
- å±è”½ Node.js è­¦å‘Šæ—¥å¿—ï¼Œç¡®ä¿åªå¾—åˆ°æœ‰æ•ˆ JSON

#### 2. **å¤„ç†å¤šä¸ª JSON å¯¹è±¡æµ** - `jq -s '.[-1]'`

ao-cli çš„æŸäº›å‘½ä»¤ï¼ˆç‰¹åˆ«æ˜¯ `eval --wait` å’Œ `message --wait`ï¼‰å¯èƒ½è¿”å›å¤šä¸ª JSON å¯¹è±¡ï¼š

```bash
# å‘½ä»¤è¾“å‡ºå¯èƒ½åŒ…å«ï¼š
# { "command": "eval", "success": true, ... }  # æ¶ˆæ¯å‘é€ç¡®è®¤
# { "command": "eval", "success": true, ... }  # æ‰§è¡Œç»“æœ

# ä½¿ç”¨ jq -s å°†æµè½¬ä¸ºæ•°ç»„ï¼Œ.[-1] å–æœ€åä¸€ä¸ª
FINAL_RESULT=$(echo "$RAW_OUTPUT" | jq -s '.[-1]' 2>/dev/null)
```

**æ³¨æ„**ï¼šå¿…é¡»ä½¿ç”¨ `jq -s '.[-1]'` è€Œä¸æ˜¯ç›´æ¥ç”¨ `jq`ï¼Œå¦åˆ™ä¼šé”™è¯¯åœ°å¤„ç†ç¬¬äºŒä¸ª JSON å¯¹è±¡ã€‚

#### 3. **éšè— jq é”™è¯¯** - `2>/dev/null`

æ‰€æœ‰ `jq` è°ƒç”¨éƒ½è¦åœ¨æœ«å°¾åŠ  `2>/dev/null`ï¼Œé¿å…ï¼š
- è§£æé”™è¯¯ä¿¡æ¯æ±¡æŸ“è¾“å‡º
- jq é”™è¯¯ä¸å‘½ä»¤ç»“æœæ··æ·†

```bash
# âŒ ä¸å¥½çš„åšæ³•
local current_length=$(echo "$json_output" | jq -r '.data.result.Output.data')

# âœ… å¥½çš„åšæ³•
local current_length=$(echo "$json_output" | jq -r '.data.result.Output.data // "0"' 2>/dev/null)
```

#### 4. **æˆåŠŸæ£€æŸ¥çš„ç»Ÿä¸€æ–¹å¼** - `jq -e '.success == true'`

```bash
if echo "$JSON_OUTPUT" | jq -e '.success == true' >/dev/null 2>&1; then
    echo "âœ… æ“ä½œæˆåŠŸ"
else
    echo "âŒ æ“ä½œå¤±è´¥"
fi
```

**ä¼˜ç‚¹**ï¼š
- ç»Ÿä¸€çš„æˆåŠŸåˆ¤æ–­é€»è¾‘
- é¿å…è§£æå…·ä½“å­—æ®µæ—¶çš„å¼‚å¸¸
- æ¸…æ™°çš„è¯­ä¹‰

#### 5. **æ•°æ®æå–çš„é˜²å¾¡æ€§ç¼–ç¨‹**

å§‹ç»ˆä½¿ç”¨ `// "é»˜è®¤å€¼"` æä¾›å¤‡é€‰å€¼ï¼š

```bash
# âŒ å®¹æ˜“å‡ºé”™
local value=$(echo "$json" | jq -r '.data.field')

# âœ… é˜²å¾¡æ€§ç¼–ç¨‹
local value=$(echo "$json" | jq -r '.data.field // "0"' 2>/dev/null)
```

### å…·ä½“æ”¹è¿›å¯¹æ¯”

| æ“ä½œ            | åŸæ¥ï¼ˆè„†å¼±ï¼‰                | æ”¹è¿›åï¼ˆå¥å£®ï¼‰                     |
| --------------- | --------------------------- | ---------------------------------- |
| Spawn è¿›ç¨‹      | `grep "Process ID:" \| awk` | `jq -r '.data.processId'`          |
| éªŒè¯æˆåŠŸ        | æ£€æŸ¥å‘½ä»¤é€€å‡ºç               | `jq -e '.success == true'`         |
| æå– Inbox é•¿åº¦ | å¤æ‚ sed è¡¨è¾¾å¼             | `jq -r '.data.result.Output.data'` |
| æ˜¾ç¤ºæ¶ˆæ¯        | grep + sed ç»„åˆæ‹³           | `jq -r '.data.inbox'`              |
| é”™è¯¯å¤„ç†        | æ‰‹åŠ¨æ£€æŸ¥è¾“å‡º                | JSON ç»“æ„ä¿è¯æ ¼å¼                  |

### æ”¹è¿›æˆæœ

æ”¹è¿›åçš„è„šæœ¬ï¼š
- **ä»£ç è¡Œæ•°å‡å°‘**ï¼š132 è¡Œæ”¹ä¸º 44 è¡Œï¼ˆ-67%ï¼‰
- **å¯è¯»æ€§æé«˜**ï¼šJSON æŸ¥è¯¢æ¯” sed è¡¨è¾¾å¼æ›´å®¹æ˜“ç†è§£
- **å¯ç»´æŠ¤æ€§æ”¹å–„**ï¼šao-cli è¾“å‡ºæ ¼å¼å˜åŒ–æ—¶åªéœ€æ›´æ–° jq è¡¨è¾¾å¼
- **å¯é æ€§å¢å¼º**ï¼šç»“æ„åŒ–æ•°æ®ä¿è¯ä¸ä¼šå‡ºç°è§£æå¼‚å¸¸
- **æµ‹è¯•é€šè¿‡ç‡**ï¼š10/10 æ­¥éª¤å…¨éƒ¨é€šè¿‡ï¼Œé›¶è¯¯æŠ¥

### åç»­è¿ç§»æŒ‡å¯¼

å¯¹å…¶ä»–æµ‹è¯•è„šæœ¬è¿›è¡Œç±»ä¼¼æ”¹è¿›æ—¶ï¼Œéµå¾ªæ­¤æ£€æŸ¥æ¸…å•ï¼š

- [ ] æ‰€æœ‰ `ao-cli` è°ƒç”¨æ·»åŠ  `--json` å’Œ `2>/dev/null`
- [ ] ä½¿ç”¨ `run_ao_cli()` helper å‡½æ•°ç»Ÿä¸€ç®¡ç†
- [ ] å¤„ç†å¤šä¸ª JSON å¯¹è±¡æƒ…å†µï¼š`jq -s '.[-1]'`
- [ ] æˆåŠŸæ£€æŸ¥ï¼š`jq -e '.success == true'`
- [ ] æ•°æ®æå–ï¼š`jq -r '.path.to.field // "default"'`
- [ ] æ‰€æœ‰ jq è°ƒç”¨åŠ  `2>/dev/null`
- [ ] ç§»é™¤è¿‡æ—¶çš„ grep/sed/awk è§£æé€»è¾‘
- [ ] æ¸…ç†æ— å¿…è¦çš„ debug è¾“å‡º
