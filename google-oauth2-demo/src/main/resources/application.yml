server:
  port: 8081  # 隧道暴露端口

app:
  frontend:
    type: react  # 可选值: thymeleaf（传统模板）, react（现代SPA）
  jwt:
    # JWT密钥配置
    # 优先级: 配置项 > 环境变量(JWT_SECRET) > 配置的密钥文件 > 默认文件(jwt-secret.key) > 默认密钥(仅开发环境)
    secret: ""  # 直接配置JWT密钥，生产环境推荐使用环境变量
    secret-file: ""  # 配置密钥文件路径
  # CORS配置
  cors:
    allowed-origins:
      - https://api.u2511175.nyat.app:55139
      - http://localhost:5173
      - http://localhost:8080
      - http://localhost:8081
    allowed-methods:
      - GET
      - POST
      - PUT
      - DELETE
      - OPTIONS
    allowed-headers:
      - "*"
    exposed-headers:
      - Authorization
    allow-credentials: true
    max-age: 3600

# JWT配置
jwt:
  # RSA密钥配置
  rsa:
    key-file: rsa-keys.ser
  # Token过期时间配置（毫秒）
  expires:
    access-token: 3600000  # 1小时
    refresh-token: 604800000  # 7天
  # 令牌配置
  token:
    issuer: https://auth.example.com
    audience: resource-server
    kid: key-1

spring:
  application:
    name: google-oauth2-demo
  profiles:
    active: test
    # dev 默认使用 SQLite 数据库，test 使用 PostgreSQL 数据库，prod 使用 PostgreSQL 数据库

  # 数据库配置由环境特定的配置文件（application-{profile}.yml）接管
  # - application-dev.yml: SQLite配置
  # - application-test.yml: PostgreSQL配置
  # - application-prod.yml: PostgreSQL生产配置

  jpa:
    # JPA配置由环境特定的配置文件提供

  # Spring Session JDBC 配置 - Session 持久化到数据库
  session:
    store-type: jdbc                # 使用 JDBC 存储 session（而不是内存）
    jdbc:
      initialize-schema: always     # 应用启动时自动创建 SPRING_SESSION 表
    timeout: 1800                   # Session 超时时间：30分钟（单位：秒）
    cookie:
      name: JSESSIONID              # Session Cookie 名称
      http-only: true               # HttpOnly，防止 XSS 攻击
      path: /                        # Cookie 路径
      same-site: Lax                # SameSite 属性，防止 CSRF 攻击

  security:
    oauth2:
      client:
        registration:
          google:
            client-id: ${GOOGLE_CLIENT_ID:your-client-id}
            client-secret: ${GOOGLE_CLIENT_SECRET:your-client-secret}
            scope:
              - openid
              - profile
              - email
            redirect-uri: https://api.u2511175.nyat.app:55139/oauth2/callback
          github:
            client-id: ${GITHUB_CLIENT_ID:your-github-client-id}
            client-secret: ${GITHUB_CLIENT_SECRET:your-github-client-secret}
            scope:
              - user:email
              - read:user
            redirect-uri: https://api.u2511175.nyat.app:55139/oauth2/callback
          x:  # ✅ X API v2：提供者名改为 'x'
            client-id: ${TWITTER_CLIENT_ID:your-twitter-client-id}
            client-secret: ${TWITTER_CLIENT_SECRET:your-twitter-client-secret}
            authorization-grant-type: authorization_code
            scope:
              - tweet.read
              - users.read
              - follows.read
              - like.read
              - offline.access
            redirect-uri: https://api.u2511175.nyat.app:55139/oauth2/callback
        provider:
          google:
            authorization-uri: https://accounts.google.com/o/oauth2/v2/auth?prompt=select_account
            token-uri: https://oauth2.googleapis.com/token
            user-info-uri: https://openidconnect.googleapis.com/v1/userinfo
            user-name-attribute: sub
            jwk-set-uri: https://www.googleapis.com/oauth2/v3/certs
          github:
            authorization-uri: https://github.com/login/oauth/authorize?prompt=consent
            token-uri: https://github.com/login/oauth/access_token
            user-info-uri: https://api.github.com/user
            user-name-attribute: login
          x:  # ✅ X API v2：提供者名改为 'x'
            authorization-uri: https://x.com/i/oauth2/authorize
            token-uri: https://api.x.com/2/oauth2/token
            user-info-uri: https://api.x.com/2/users/me
            user-name-attribute: data.username  # ✅ 响应格式改变：包装在data字段中
            jwk-set-uri: https://x.com/i/oauth2/jwks

  thymeleaf:
    cache: false
    prefix: classpath:/templates/
    suffix: .html

  web:
    resources:
      static-locations: classpath:/static/, classpath:/public/, classpath:/resources/, classpath:/META-INF/resources/
      cache:
        period: 0  # 开发环境禁用缓存
      # 静态资源服务配置会根据app.frontend.type动态决定

logging:
  level:
    com.example.oauth2demo: DEBUG
    org.springframework.security: DEBUG
    org.springframework.web: DEBUG
    org.springframework.security.oauth2: DEBUG
    org.springframework.session: DEBUG                    # 显示 Session 操作日志
    org.springframework.session.jdbc.JdbcOperationsSessionRepository: DEBUG  # 显示 JDBC Session 详细操作
