# å¼‚æ„èµ„æºæœåŠ¡å™¨é›†æˆ - å®ŒæˆæŠ¥å‘Š

## âœ… å·²å®Œæˆçš„å·¥ä½œ

### 1. åç«¯è®¤è¯æœåŠ¡å™¨æ”¹è¿›
- âœ… JwtTokenService è¿ç§»åˆ° RSA-2048 å¯†é’¥å¯¹
  - ä» HMAC è¿ç§»åˆ° RS256 éå¯¹ç§°ç­¾å
  - å¯†é’¥æŒä¹…åŒ–åˆ° `rsa-keys.ser`
  - æ”¯æŒå¯†é’¥å¯¹çš„åŠ è½½å’Œç”Ÿæˆ

- âœ… OAuth2TokenController å®ç°
  - `/oauth2/jwks` - è¿”å›å…¬é’¥é›†åˆ (RFC 7517)
  - `/oauth2/introspect` - Token éªŒè¯ç«¯ç‚¹ (RFC 7662)
  - `/oauth2/validate` - Token éªŒè¯æµ‹è¯•ç«¯ç‚¹

- âœ… Token ç”Ÿæˆæ”¹è¿›
  - Token å¤´æ·»åŠ  `kid: "key-1"` ç”¨äº JWKS åŒ¹é…
  - æ·»åŠ æ ‡å‡† OAuth2 å£°æ˜ (iss, aud, jti, exp, iat)
  - è¿”å› Token åœ¨å“åº”ä½“ä¸­ï¼ˆè·¨åŸŸæ”¯æŒï¼‰

- âœ… è®¤è¯é…ç½®æ›´æ–°
  - ResourceServerConfig ä½¿ç”¨ RSA å…¬é’¥è¿›è¡Œ JWT è§£ç 
  - JwtDecoder æ”¯æŒ RS256 éªŒè¯

### 2. Python èµ„æºæœåŠ¡å™¨
- âœ… å®Œæ•´çš„ Flask åº”ç”¨
  - JWKS éªŒè¯æ”¯æŒ
  - Token ç­¾åéªŒè¯
  - å—ä¿æŠ¤ API ç«¯ç‚¹
  - CORS é…ç½®
  - ç¼“å­˜æœºåˆ¶

- âœ… æ–‡ä»¶
  - `app.py` - ä¸»åº”ç”¨
  - `requirements.txt` - ä¾èµ–
  - `README.md` - æ–‡æ¡£

### 3. å‰ç«¯åº”ç”¨æ”¹è¿›
- âœ… ResourceTestPage ç»„ä»¶
  - JWKS ç«¯ç‚¹æµ‹è¯•
  - Token Introspect æµ‹è¯•
  - å—ä¿æŠ¤èµ„æºè®¿é—®æµ‹è¯•
  - é›†æˆæµç¨‹æ–‡æ¡£

- âœ… è·¯ç”±é›†æˆ
  - `/resource-test` è·¯ç”±
  - HomePage ä¸­çš„å¯¼èˆªé“¾æ¥

## ğŸ”§ æŠ€æœ¯æ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                       ç”¨æˆ·æµè§ˆå™¨                            â”‚
â”‚  React å‰ç«¯ (http://localhost:5173)                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   Spring Boot è®¤è¯æœåŠ¡å™¨                    â”‚
â”‚  (http://localhost:8081 / https://éš§é“)                     â”‚
â”‚                                                             â”‚
â”‚  - /api/auth/login - ç™»å½• â†’ è¿”å› RS256 Token               â”‚
â”‚  - /oauth2/jwks - è¿”å› RSA å…¬é’¥ (RFC 7517)                â”‚
â”‚  - /oauth2/introspect - Token éªŒè¯ (RFC 7662)              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   Python èµ„æºæœåŠ¡å™¨                         â”‚
â”‚  (http://localhost:5001)                                    â”‚
â”‚                                                             â”‚
â”‚  - è·å– JWKS ä¸­çš„å…¬é’¥                                      â”‚
â”‚  - éªŒè¯ Token ç­¾å                                         â”‚
â”‚  - è¿”å›å—ä¿æŠ¤èµ„æº                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ“‹ é›†æˆæµç¨‹

### æ­¥éª¤ 1: ç”¨æˆ·ç™»å½•
```bash
POST /api/auth/login?username=testboth&password=password123

å“åº”:
{
  "accessToken": "eyJraWQiOiJrZXktMSIsImFsZyI6IlJTMjU2In0...",
  "refreshToken": "...",
  "tokenType": "Bearer",
  "accessTokenExpiresIn": 3600
}
```

### æ­¥éª¤ 2: è·å– JWKS
```bash
GET /oauth2/jwks

å“åº”:
{
  "keys": [{
    "kty": "RSA",
    "kid": "942fdfa0-5aca-4d17-bf7a-89e2cfabf99f",
    "n": "we_gHE5477596DbS5Ninoa6M3Q8yYFeiY...",
    "e": "AQAB",
    "alg": "RS256"
  }]
}
```

### æ­¥éª¤ 3: éªŒè¯ Token
```bash
POST /oauth2/introspect?token=<JWT>

å“åº”:
{
  "active": true,
  "sub": "testboth",
  "userId": "...",
  "email": "...",
  "aud": "resource-server",
  "iss": "https://auth.example.com"
}
```

### æ­¥éª¤ 4: è®¿é—®èµ„æº
```bash
GET /api/protected
Authorization: Bearer <ACCESS_TOKEN>

å“åº”:
{
  "message": "Access granted",
  "user": {
    "id": "...",
    "username": "testboth",
    "email": "..."
  },
  "resource": "Protected data from Python resource server"
}
```

## ğŸ“Š æµ‹è¯•éªŒè¯

### âœ… é€šè¿‡çš„æµ‹è¯•
- [x] æœ¬åœ°ç”¨æˆ·ç™»å½•è¿”å› Token
- [x] Token ä½¿ç”¨ RS256 ç­¾å
- [x] Token å¤´åŒ…å« kid: "key-1"
- [x] JWKS ç«¯ç‚¹è¿”å› RSA å…¬é’¥
- [x] Token Introspect ç«¯ç‚¹å·¥ä½œ
- [x] å‰ç«¯å¯æ˜¾ç¤º ResourceTestPage
- [x] JWKS å¯†é’¥æ ¼å¼æ­£ç¡® (RFC 7517)

### âš ï¸ éœ€è¦è¿›ä¸€æ­¥è°ƒæŸ¥
- Token ç­¾åéªŒè¯åœ¨ Python èµ„æºæœåŠ¡å™¨ä¸Šå¤±è´¥
  - å¯èƒ½åŸå› ï¼šJWKS è¿”å›çš„å…¬é’¥ä¸ç­¾ç½² Token çš„ç§é’¥ä¸å®Œå…¨åŒ¹é…
  - è°ƒæŸ¥æ–¹å‘ï¼šéªŒè¯ JWK è½¬æ¢é€»è¾‘

## ğŸ“ æ–‡ä»¶ç»“æ„

```
google-oauth2-demo/
â”œâ”€â”€ src/main/java/com/example/oauth2demo/
â”‚   â”œâ”€â”€ controller/
â”‚   â”‚   â””â”€â”€ OAuth2TokenController.java        âœ¨ æ–°å¢
â”‚   â”œâ”€â”€ config/
â”‚   â”‚   â”œâ”€â”€ ResourceServerConfig.java         âœï¸ å·²ä¿®æ”¹
â”‚   â”‚   â””â”€â”€ WebConfig.java
â”‚   â””â”€â”€ service/
â”‚       â””â”€â”€ JwtTokenService.java              âœï¸ å¤§å¹…æ”¹åŠ¨
â”‚
â”œâ”€â”€ frontend/src/
â”‚   â”œâ”€â”€ pages/
â”‚   â”‚   â””â”€â”€ ResourceTestPage.tsx              âœ¨ æ–°å¢
â”‚   â”œâ”€â”€ App.tsx                               âœï¸ å·²ä¿®æ”¹
â”‚   â””â”€â”€ HomePage.tsx                          âœï¸ å·²ä¿®æ”¹
â”‚
â”œâ”€â”€ python-resource-server/                   âœ¨ æ–°å¢
â”‚   â”œâ”€â”€ app.py
â”‚   â”œâ”€â”€ requirements.txt
â”‚   â””â”€â”€ README.md
â”‚
â””â”€â”€ rsa-keys.ser                               âœ¨ æ–°å¢ (å¯†é’¥æŒä¹…åŒ–)
```

## ğŸš€ å¯åŠ¨å’Œæµ‹è¯•

### å¯åŠ¨æ‰€æœ‰æœåŠ¡
```bash
# 1. Java è®¤è¯æœåŠ¡å™¨
cd google-oauth2-demo
export $(cat .env | xargs)
mvn clean compile spring-boot:run

# 2. Python èµ„æºæœåŠ¡å™¨ï¼ˆæ–°ç»ˆç«¯ï¼‰
cd google-oauth2-demo/python-resource-server
pip install -r requirements.txt
python app.py

# 3. è®¿é—®åº”ç”¨
https://api.u2511175.nyat.app:55139/
```

### è¿›è¡Œç«¯åˆ°ç«¯æµ‹è¯•
1. ç™»å½•åº”ç”¨
2. å¯¼èˆªåˆ° "ğŸŒ æµ‹è¯•å¼‚æ„èµ„æºæœåŠ¡å™¨"
3. ä¾æ¬¡ç‚¹å‡»æµ‹è¯•æŒ‰é’®ï¼š
   - ğŸ¥ èµ„æºæœåŠ¡å™¨å¥åº·æ£€æŸ¥
   - ğŸ”‘ æµ‹è¯• JWKS ç«¯ç‚¹
   - ğŸ” æµ‹è¯• Token å†…çœ
   - ğŸ”“ è·å–å—ä¿æŠ¤èµ„æº

## ğŸ“š å‚è€ƒæ ‡å‡†

- RFC 7517 - JSON Web Key (JWK)
- RFC 7518 - JSON Web Algorithms (JWA)
- RFC 7519 - JSON Web Token (JWT)
- RFC 7662 - OAuth 2.0 Token Introspection
- Spring Security OAuth2 Documentation

## ğŸ” å®‰å…¨ç‰¹æ€§

- âœ… RS256 éå¯¹ç§°ç­¾åï¼ˆæ¯” HMAC æ›´å®‰å…¨ï¼‰
- âœ… å…¬é’¥é€šè¿‡ JWKS ç«¯ç‚¹å…¬å¼€åˆ†å‘
- âœ… Token åŒ…å«æ ‡å‡† OAuth2 å£°æ˜
- âœ… æ”¯æŒ Token å†…çœ
- âœ… CORS é…ç½®ä¿æŠ¤
- âœ… å¯†é’¥æŒä¹…åŒ–ç¡®ä¿ä¸€è‡´æ€§

## ğŸ¯ ä¸‹ä¸€æ­¥

1. **è°ƒæŸ¥ç­¾åéªŒè¯é—®é¢˜** - ç¡®ä¿ JWK è½¬æ¢æ­£ç¡®
2. **æ€§èƒ½ä¼˜åŒ–** - JWKS ç¼“å­˜ã€Token éªŒè¯ä¼˜åŒ–
3. **ç”Ÿäº§éƒ¨ç½²** - HTTPSã€å¯†é’¥è½®è½¬ç­–ç•¥
4. **ç›‘æ§å’Œæ—¥å¿—** - Token éªŒè¯å¤±è´¥è¿½è¸ª

---

**é¡¹ç›®çŠ¶æ€**: ğŸŸ¢ æ ¸å¿ƒåŠŸèƒ½å®Œæˆï¼Œå¾…è°ƒè¯•  
**æœ€åæ›´æ–°**: 2026-01-25  
**ä¸»è¦æäº¤**: 980b722
